'use strict';

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

;(function () {
	"use strict";

	var PasswordGeneratorCore = function () {
		function PasswordGeneratorCore() {
			_classCallCheck(this, PasswordGeneratorCore);
		}

		_createClass(PasswordGeneratorCore, null, [{
			key: 'getRandomChar',
			value: function getRandomChar(selectedCharTypes) {
				var types = selectedCharTypes && selectedCharTypes.length && selectedCharTypes || this.presets.charTypes;
				var randomCharType = types[Math.floor(Math.random() * types.length)];
				var charsetByType = this.presets.charset[randomCharType];
				var randomChar = charsetByType[Math.floor(Math.random() * charsetByType.length)];
				return randomChar;
			}
		}, {
			key: 'generatePassword',
			value: function generatePassword(len, selectedCharTypes) {
				var _this = this;

				len = len || this.presets.length;
				if (len > this.presets.maxLength) {
					len = this.presets.maxLength;
				}
				if (len < this.presets.minLength) {
					len = this.presets.minLength;
				}
				return Array.from(Array(len), function () {
					return _this.getRandomChar(selectedCharTypes);
				}).join('');
			}
		}]);

		return PasswordGeneratorCore;
	}();

	PasswordGeneratorCore.presets = {
		length: 16,
		minLength: 6,
		maxLength: 256,
		charTypes: ['numbers', 'uppercase', 'lowercase', 'special'],
		charset: {
			'numbers': '1234567890',
			'uppercase': 'ABCDEFGHIJKLMNOPQRSTUVWXYZ',
			'lowercase': 'abcdefghijklmnopqrstuvwxyz',
			'special': '!#$%&()*+,-./:;<=>?@[]^_{|}~'
		}
	};

	var PasswordGeneratorWidget = function () {
		function PasswordGeneratorWidget(options) {
			var _this2 = this;

			_classCallCheck(this, PasswordGeneratorWidget);

			this.CSS_CLASS_NAMES = {
				BUTTON: 'password-generator__button',
				PASSWORD: 'password-generator__password',
				PASSWORD_CONTAINER: 'password-generator__password-container',
				LENGTH: 'password-generator__length',
				LENGTH_CONTAINER: 'password-generator__length-container',
				TOOLBAR: 'password-generator__toolbar',
				PASSWORD_GENERATOR: 'password-generator',
				CLEARFIX: 'clearfix',
				TOOLTIP: 'password-generator__tooltip',
				CHARSET_LIST: 'password-generator__charset-list',
				CHARSET_LIST_LABEL: 'password-generator__charset-list__label',
				CHARSET_LIST_CHECKBOX: 'password-generator__charset-list__checkbox'
			};
			this.SELECTORS = {
				CONTAINER: '#password-generator'
			};
			this.elements = {};
			this.CONSTANTS = { DELAY: 1000 };
			this.MESSAGES = {
				PASSWORD_COPIED: 'copied',
				HIDE: 'hide',
				SHOW: 'show'
			};

			this.passwordOnMouseUpHandler = function (e) {
				var elem = e.target;

				// selects password and copy it to clipboard
				// does not work on iOS devices
				elem.setSelectionRange(0, elem.value.length);
				document.execCommand('copy');
			};

			this.onCopyEventHandler = function (event) {
				if (_this2.elements.tooltip) {
					return;
				}

				//creates notification message
				var tooltip = _this2.createElement('div', { className: _this2.CSS_CLASS_NAMES.TOOLTIP }, [_this2.MESSAGES.PASSWORD_COPIED]);
				_this2.elements.tooltip = tooltip;
				var passwordElem = _this2.elements.password;
				passwordElem.parentNode.insertBefore(tooltip, passwordElem.nextSibling);

				//sets a notification display timeout
				setTimeout(function () {
					tooltip.remove();_this2.elements.tooltip = null;
				}, _this2.CONSTANTS.DELAY);
			};

			this.lenghOnChangeHandler = function (event) {
				var elem = event.target;
				_this2.length = parseInt(elem.value);
			};

			this.buttonClickHandler = function (e) {
				e.preventDefault();
				_this2.elements.password.value = _this2.core.generatePassword(_this2.length, _this2.getCharsetList());
			};

			this.injectDependencies();
			this.initOptions(options);
			this.initWidget();
			this.assignListeners();
		}

		_createClass(PasswordGeneratorWidget, [{
			key: 'injectDependencies',
			value: function injectDependencies() {
				this.core = PasswordGeneratorCore;
				this.createElement = createElement;
			}
		}, {
			key: 'initOptions',
			value: function initOptions() {
				var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};

				this.length = options.length || this.core.presets.length;
				this.minLength = options.minLength || this.core.presets.minLength;
				this.maxLength = options.maxLength || this.core.presets.maxLength;
				this.container = document.querySelector(options.selector || this.SELECTORS.CONTAINER);
				this.charset = options.charset || this.core.presets.charset;
				this.charTypes = options.charTypes || this.core.presets.charTypes;
			}
		}, {
			key: 'initWidget',
			value: function initWidget() {
				this.widget = this.generateWidgetContent(this.container);
				this.elements.password.value = this.core.generatePassword(this.length);
			}
		}, {
			key: 'assignListeners',
			value: function assignListeners() {
				this.elements.button.addEventListener('click', this.buttonClickHandler);
				//shows notification after password was copied
				this.widget.addEventListener('copy', this.onCopyEventHandler);
				this.elements.password.addEventListener('mouseup', this.passwordOnMouseUpHandler);
				this.elements.length.addEventListener('change', this.lenghOnChangeHandler);
			}
		}, {
			key: 'generateWidgetContent',
			value: function generateWidgetContent(widgetContainer) {
				var password = this.createElement('input', { className: this.CSS_CLASS_NAMES.PASSWORD, type: 'text', value: 'password' });
				this.elements.password = password;
				var passwordContainer = this.createElement('div', { className: this.CSS_CLASS_NAMES.PASSWORD_CONTAINER }, [password]);
				var generateButton = this.createElement('input', { className: this.CSS_CLASS_NAMES.BUTTON, type: 'button', value: 'generate' });
				this.elements.button = generateButton;
				var length = this.generateLengthElement();
				this.elements.length = length;
				var lengthContainer = this.createElement('div', { className: this.CSS_CLASS_NAMES.LENGTH_CONTAINER }, [length]);
				var charsetList = this.generateCharsetListElement();
				this.elements.charsetList = charsetList;
				var widget = this.createElement('div', { className: this.CSS_CLASS_NAMES.PASSWORD_GENERATOR + ' ' + this.CSS_CLASS_NAMES.CLEARFIX }, [passwordContainer, generateButton, lengthContainer, charsetList]);
				widgetContainer.appendChild(widget);
				return widget;
			}

			//copies password to clipboard


			//shows "copied" notification

		}, {
			key: 'getCharsetList',
			value: function getCharsetList() {
				var list = this.elements.charsetList.items.slice() || [];
				list = list.filter(function (item) {
					return item.checked;
				}).map(function (item) {
					return item.name;
				});
				return list;
			}
		}, {
			key: 'generateLengthElement',
			value: function generateLengthElement() {
				var container = this.createElement('select', { className: this.CSS_CLASS_NAMES.LENGTH });

				for (var l = 0; l <= this.maxLength - this.minLength; l++) {
					var value = l + this.minLength;
					var option = this.createElement('option', { value: value, innerHTML: value, selected: value === this.length ? true : false });
					container.appendChild(option);
				}

				return container;
			}
		}, {
			key: 'generateCharsetListElement',
			value: function generateCharsetListElement() {
				var container = this.createElement('div', { className: this.CSS_CLASS_NAMES.CHARSET_LIST, items: [] });
				var charset = this.charset;

				for (var str in charset) {
					var input = this.createElement('input', { className: this.CSS_CLASS_NAMES.CHARSET_LIST_CHECKBOX, type: 'checkbox', name: str, value: str, checked: this.charTypes.includes(str) ? true : false });
					var label = this.createElement('label', { className: this.CSS_CLASS_NAMES.CHARSET_LIST_LABEL }, [input, str]);
					container.items.push(input);
					container.appendChild(label);
				}

				return container;
			}
		}]);

		return PasswordGeneratorWidget;
	}();

	window.PasswordGeneratorWidget = PasswordGeneratorWidget;
})();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImpzL3Bhc3NnZW4uanMiXSwibmFtZXMiOlsiUGFzc3dvcmRHZW5lcmF0b3JDb3JlIiwic2VsZWN0ZWRDaGFyVHlwZXMiLCJ0eXBlcyIsImxlbmd0aCIsInByZXNldHMiLCJjaGFyVHlwZXMiLCJyYW5kb21DaGFyVHlwZSIsIk1hdGgiLCJmbG9vciIsInJhbmRvbSIsImNoYXJzZXRCeVR5cGUiLCJjaGFyc2V0IiwicmFuZG9tQ2hhciIsImxlbiIsIm1heExlbmd0aCIsIm1pbkxlbmd0aCIsIkFycmF5IiwiZnJvbSIsImdldFJhbmRvbUNoYXIiLCJqb2luIiwiUGFzc3dvcmRHZW5lcmF0b3JXaWRnZXQiLCJvcHRpb25zIiwiQ1NTX0NMQVNTX05BTUVTIiwiQlVUVE9OIiwiUEFTU1dPUkQiLCJQQVNTV09SRF9DT05UQUlORVIiLCJMRU5HVEgiLCJMRU5HVEhfQ09OVEFJTkVSIiwiVE9PTEJBUiIsIlBBU1NXT1JEX0dFTkVSQVRPUiIsIkNMRUFSRklYIiwiVE9PTFRJUCIsIkNIQVJTRVRfTElTVCIsIkNIQVJTRVRfTElTVF9MQUJFTCIsIkNIQVJTRVRfTElTVF9DSEVDS0JPWCIsIlNFTEVDVE9SUyIsIkNPTlRBSU5FUiIsImVsZW1lbnRzIiwiQ09OU1RBTlRTIiwiREVMQVkiLCJNRVNTQUdFUyIsIlBBU1NXT1JEX0NPUElFRCIsIkhJREUiLCJTSE9XIiwicGFzc3dvcmRPbk1vdXNlVXBIYW5kbGVyIiwiZSIsImVsZW0iLCJ0YXJnZXQiLCJzZXRTZWxlY3Rpb25SYW5nZSIsInZhbHVlIiwiZG9jdW1lbnQiLCJleGVjQ29tbWFuZCIsIm9uQ29weUV2ZW50SGFuZGxlciIsImV2ZW50IiwidG9vbHRpcCIsImNyZWF0ZUVsZW1lbnQiLCJjbGFzc05hbWUiLCJwYXNzd29yZEVsZW0iLCJwYXNzd29yZCIsInBhcmVudE5vZGUiLCJpbnNlcnRCZWZvcmUiLCJuZXh0U2libGluZyIsInNldFRpbWVvdXQiLCJyZW1vdmUiLCJsZW5naE9uQ2hhbmdlSGFuZGxlciIsInBhcnNlSW50IiwiYnV0dG9uQ2xpY2tIYW5kbGVyIiwicHJldmVudERlZmF1bHQiLCJjb3JlIiwiZ2VuZXJhdGVQYXNzd29yZCIsImdldENoYXJzZXRMaXN0IiwiaW5qZWN0RGVwZW5kZW5jaWVzIiwiaW5pdE9wdGlvbnMiLCJpbml0V2lkZ2V0IiwiYXNzaWduTGlzdGVuZXJzIiwiY29udGFpbmVyIiwicXVlcnlTZWxlY3RvciIsInNlbGVjdG9yIiwid2lkZ2V0IiwiZ2VuZXJhdGVXaWRnZXRDb250ZW50IiwiYnV0dG9uIiwiYWRkRXZlbnRMaXN0ZW5lciIsIndpZGdldENvbnRhaW5lciIsInR5cGUiLCJwYXNzd29yZENvbnRhaW5lciIsImdlbmVyYXRlQnV0dG9uIiwiZ2VuZXJhdGVMZW5ndGhFbGVtZW50IiwibGVuZ3RoQ29udGFpbmVyIiwiY2hhcnNldExpc3QiLCJnZW5lcmF0ZUNoYXJzZXRMaXN0RWxlbWVudCIsImFwcGVuZENoaWxkIiwibGlzdCIsIml0ZW1zIiwic2xpY2UiLCJmaWx0ZXIiLCJpdGVtIiwiY2hlY2tlZCIsIm1hcCIsIm5hbWUiLCJsIiwib3B0aW9uIiwiaW5uZXJIVE1MIiwic2VsZWN0ZWQiLCJzdHIiLCJpbnB1dCIsImluY2x1ZGVzIiwibGFiZWwiLCJwdXNoIiwid2luZG93Il0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQSxDQUFDLENBQUMsWUFBWTtBQUNiOztBQURhLEtBR1BBLHFCQUhPO0FBQUE7QUFBQTtBQUFBOztBQUFBO0FBQUE7QUFBQSxpQ0FpQlVDLGlCQWpCVixFQWlCNkI7QUFDdkMsUUFBTUMsUUFBUUQscUJBQXFCQSxrQkFBa0JFLE1BQXZDLElBQWlERixpQkFBakQsSUFBc0UsS0FBS0csT0FBTCxDQUFhQyxTQUFqRztBQUNBLFFBQU1DLGlCQUFpQkosTUFBTUssS0FBS0MsS0FBTCxDQUFXRCxLQUFLRSxNQUFMLEtBQWdCUCxNQUFNQyxNQUFqQyxDQUFOLENBQXZCO0FBQ0EsUUFBTU8sZ0JBQWdCLEtBQUtOLE9BQUwsQ0FBYU8sT0FBYixDQUFxQkwsY0FBckIsQ0FBdEI7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LFVBQVUsS0FBS0EsT0FBckI7O0FBRUEsU0FBSyxJQUFJNEYsR0FBVCxJQUFnQjVGLE9BQWhCLEVBQXdCO0FBQ3ZCLFNBQU02RixRQUFRLEtBQUtqRCxhQUFMLENBQW1CLE9BQW5CLEVBQTRCLEVBQUNDLFdBQVcsS0FBS2xDLGVBQUwsQ0FBcUJZLHFCQUFqQyxFQUF3RGlELE1BQU0sVUFBOUQsRUFBMEVlLE1BQU1LLEdBQWhGLEVBQXFGdEQsT0FBT3NELEdBQTVGLEVBQWlHUCxTQUFTLEtBQUszRixTQUFMLENBQWVvRyxRQUFmLENBQXdCRixHQUF4QixJQUErQixJQUEvQixHQUFzQyxLQUFoSixFQUE1QixDQUFkO0FBQ0EsU0FBTUcsUUFBUSxLQUFLbkQsYUFBTCxDQUFtQixPQUFuQixFQUE0QixFQUFDQyxXQUFXLEtBQUtsQyxlQUFMLENBQXFCVyxrQkFBakMsRUFBNUIsRUFBa0YsQ0FBQ3VFLEtBQUQsRUFBUUQsR0FBUixDQUFsRixDQUFkO0FBQ0E1QixlQUFVaUIsS0FBVixDQUFnQmUsSUFBaEIsQ0FBcUJILEtBQXJCO0FBQ0E3QixlQUFVZSxXQUFWLENBQXNCZ0IsS0FBdEI7QUFDQTs7QUFFRCxXQUFPL0IsU0FBUDtBQUNBO0FBN0tXOztBQUFBO0FBQUE7O0FBcUxiaUMsUUFBT3hGLHVCQUFQLEdBQWlDQSx1QkFBakM7QUFDQSxDQXRMQSIsImZpbGUiOiJqcy9wYXNzZ2VuLmpzIiwic291cmNlc0NvbnRlbnQiOlsiOyhmdW5jdGlvbiAoKSB7XG5cdFwidXNlIHN0cmljdFwiO1xuXG5cdGNsYXNzIFBhc3N3b3JkR2VuZXJhdG9yQ29yZSB7XG5cdFx0XHRzdGF0aWMgcHJlc2V0cyA9IHtcblx0XHRcdFx0bGVuZ3RoOiAxNixcblx0XHRcdFx0bWluTGVuZ3RoOiA2LFxuXHRcdFx0XHRtYXhMZW5ndGg6IDI1Nixcblx0XHRcdFx0Y2hhclR5cGVzOiBbJ251bWJlcnMnLCAndXBwZXJjYXNlJywgJ2xvd2VyY2FzZScsICdzcGVjaWFsJ10sXG5cdFx0XHRcdGNoYXJzZXQ6IHtcblx0XHRcdFx0XHQnbnVtYmVycyc6ICcxMjM0NTY3ODkwJyxcblx0XHRcdFx0XHQndXBwZXJjYXNlJzogJ0FCQ0RFRkdISUpLTE1OT1BRUlNUVVZXWFlaJyxcblx0XHRcdFx0XHQnbG93ZXJjYXNlJzogJ2FiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6Jyxcblx0XHRcdFx0XHQnc3BlY2lhbCc6ICchIyQlJigpKissLS4vOjs8PT4/QFtdXl97fH1+J1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdHN0YXRpYyBnZXRSYW5kb21DaGFyKHNlbGVjdGVkQ2hhclR5cGVzKSB7XG5cdFx0XHRcdGNvbnN0IHR5cGVzID0gc2VsZWN0ZWRDaGFyVHlwZXMgJiYgc2VsZWN0ZWRDaGFyVHlwZXMubGVuZ3RoICYmIHNlbGVjdGVkQ2hhclR5cGVzIHx8IHRoaXMucHJlc2V0cy5jaGFyVHlwZXM7XG5cdFx0XHRcdGNvbnN0IHJhbmRvbUNoYXJUeXBlID0gdHlwZXNbTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogdHlwZXMubGVuZ3RoKV07XG5cdFx0XHRcdGNvbnN0IGNoYXJzZXRCeVR5cGUgPSB0aGlzLnByZXNldHMuY2hhcnNldFtyYW5kb21DaGFyVHlwZV07XG5cdFx0XHRcdGNvbnN0IHJhbmRvbUNoYXIgPSBjaGFyc2V0QnlUeXBlW01hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIGNoYXJzZXRCeVR5cGUubGVuZ3RoKV07XG5cdFx0XHRcdHJldHVybiByYW5kb21DaGFyO1xuXHRcdFx0fVxuXG5cdFx0XHRzdGF0aWMgZ2VuZXJhdGVQYXNzd29yZCAobGVuLCBzZWxlY3RlZENoYXJUeXBlcykge1xuXHRcdFx0XHRsZW4gPSBsZW4gfHwgdGhpcy5wcmVzZXRzLmxlbmd0aDtcblx0XHRcdFx0aWYgKGxlbiA+IHRoaXMucHJlc2V0cy5tYXhMZW5ndGgpIHsgbGVuID0gdGhpcy5wcmVzZXRzLm1heExlbmd0aDsgfVxuXHRcdFx0XHRpZiAobGVuIDwgdGhpcy5wcmVzZXRzLm1pbkxlbmd0aCkgeyBsZW4gPSB0aGlzLnByZXNldHMubWluTGVuZ3RoOyB9XG5cdFx0XHRcdHJldHVybiBBcnJheS5mcm9tKEFycmF5KGxlbiksICgpID0+IHRoaXMuZ2V0UmFuZG9tQ2hhcihzZWxlY3RlZENoYXJUeXBlcykpLmpvaW4oJycpO1xuXHRcdFx0fVxuXHR9XG5cblx0Y2xhc3MgUGFzc3dvcmRHZW5lcmF0b3JXaWRnZXQge1xuXHRcdENTU19DTEFTU19OQU1FUyA9IHtcblx0XHRcdEJVVFRPTjogJ3Bhc3N3b3JkLWdlbmVyYXRvcl9fYnV0dG9uJyxcblx0XHRcdFBBU1NXT1JEOiAncGFzc3dvcmQtZ2VuZXJhdG9yX19wYXNzd29yZCcsXG5cdFx0XHRQQVNTV09SRF9DT05UQUlORVI6ICdwYXNzd29yZC1nZW5lcmF0b3JfX3Bhc3N3b3JkLWNvbnRhaW5lcicsXG5cdFx0XHRMRU5HVEg6ICdwYXNzd29yZC1nZW5lcmF0b3JfX2xlbmd0aCcsXG5cdFx0XHRMRU5HVEhfQ09OVEFJTkVSOiAncGFzc3dvcmQtZ2VuZXJhdG9yX19sZW5ndGgtY29udGFpbmVyJyxcblx0XHRcdFRPT0xCQVI6ICdwYXNzd29yZC1nZW5lcmF0b3JfX3Rvb2xiYXInLFxuXHRcdFx0UEFTU1dPUkRfR0VORVJBVE9SOiAncGFzc3dvcmQtZ2VuZXJhdG9yJyxcblx0XHRcdENMRUFSRklYOiAnY2xlYXJmaXgnLFxuXHRcdFx0VE9PTFRJUDogJ3Bhc3N3b3JkLWdlbmVyYXRvcl9fdG9vbHRpcCcsXG5cdFx0XHRDSEFSU0VUX0xJU1Q6ICdwYXNzd29yZC1nZW5lcmF0b3JfX2NoYXJzZXQtbGlzdCcsXG5cdFx0XHRDSEFSU0VUX0xJU1RfTEFCRUw6ICdwYXNzd29yZC1nZW5lcmF0b3JfX2NoYXJzZXQtbGlzdF9fbGFiZWwnLFxuXHRcdFx0Q0hBUlNFVF9MSVNUX0NIRUNLQk9YOiAncGFzc3dvcmQtZ2VuZXJhdG9yX19jaGFyc2V0LWxpc3RfX2NoZWNrYm94Jyxcblx0XHR9O1xuXG5cdFx0U0VMRUNUT1JTID0ge1xuXHRcdFx0Q09OVEFJTkVSOiAnI3Bhc3N3b3JkLWdlbmVyYXRvcicsXG5cdFx0fTtcblxuXHRcdGVsZW1lbnRzID0ge307XG5cblx0XHRDT05TVEFOVFMgPSB7REVMQVk6IDEwMDB9O1xuXG5cdFx0TUVTU0FHRVMgPSB7XG5cdFx0XHRQQVNTV09SRF9DT1BJRUQ6ICdjb3BpZWQnLFxuXHRcdFx0SElERTogJ2hpZGUnLFxuXHRcdFx0U0hPVzogJ3Nob3cnLFxuXHRcdH07XG5cblx0XHRjb25zdHJ1Y3RvcihvcHRpb25zKXtcblx0XHRcdHRoaXMuaW5qZWN0RGVwZW5kZW5jaWVzKCk7XG5cdFx0XHR0aGlzLmluaXRPcHRpb25zKG9wdGlvbnMpO1xuXHRcdFx0dGhpcy5pbml0V2lkZ2V0KCk7XG5cdFx0XHR0aGlzLmFzc2lnbkxpc3RlbmVycygpO1xuXHRcdH1cblxuXHRcdGluamVjdERlcGVuZGVuY2llcygpIHtcblx0XHRcdHRoaXMuY29yZSA9IFBhc3N3b3JkR2VuZXJhdG9yQ29yZTtcblx0XHRcdHRoaXMuY3JlYXRlRWxlbWVudCA9IGNyZWF0ZUVsZW1lbnQ7XG5cdFx0fVxuXG5cdFx0aW5pdE9wdGlvbnMob3B0aW9ucyA9IHt9KSB7XG5cdFx0XHR0aGlzLmxlbmd0aCA9IG9wdGlvbnMubGVuZ3RoIHx8IHRoaXMuY29yZS5wcmVzZXRzLmxlbmd0aDtcblx0XHRcdHRoaXMubWluTGVuZ3RoID0gb3B0aW9ucy5taW5MZW5ndGggfHwgdGhpcy5jb3JlLnByZXNldHMubWluTGVuZ3RoO1xuXHRcdFx0dGhpcy5tYXhMZW5ndGggPSBvcHRpb25zLm1heExlbmd0aCB8fCB0aGlzLmNvcmUucHJlc2V0cy5tYXhMZW5ndGg7XG5cdFx0XHR0aGlzLmNvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3Iob3B0aW9ucy5zZWxlY3RvciB8fCB0aGlzLlNFTEVDVE9SUy5DT05UQUlORVIpO1xuXHRcdFx0dGhpcy5jaGFyc2V0ID0gb3B0aW9ucy5jaGFyc2V0IHx8IHRoaXMuY29yZS5wcmVzZXRzLmNoYXJzZXQ7XG5cdFx0XHR0aGlzLmNoYXJUeXBlcyA9IG9wdGlvbnMuY2hhclR5cGVzIHx8IHRoaXMuY29yZS5wcmVzZXRzLmNoYXJUeXBlcztcblx0XHR9XG5cblx0XHRpbml0V2lkZ2V0KCkge1xuXHRcdFx0dGhpcy53aWRnZXQgPSB0aGlzLmdlbmVyYXRlV2lkZ2V0Q29udGVudCh0aGlzLmNvbnRhaW5lcik7XG5cdFx0XHR0aGlzLmVsZW1lbnRzLnBhc3N3b3JkLnZhbHVlID0gdGhpcy5jb3JlLmdlbmVyYXRlUGFzc3dvcmQodGhpcy5sZW5ndGgpO1xuXHRcdH1cblxuXHRcdGFzc2lnbkxpc3RlbmVycygpIHtcblx0XHRcdHRoaXMuZWxlbWVudHMuYnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5idXR0b25DbGlja0hhbmRsZXIpO1xuXHRcdFx0Ly9zaG93cyBub3RpZmljYXRpb24gYWZ0ZXIgcGFzc3dvcmQgd2FzIGNvcGllZFxuXHRcdFx0dGhpcy53aWRnZXQuYWRkRXZlbnRMaXN0ZW5lcignY29weScsIHRoaXMub25Db3B5RXZlbnRIYW5kbGVyKTtcblx0XHRcdHRoaXMuZWxlbWVudHMucGFzc3dvcmQuYWRkRXZlbnRMaXN0ZW5lcignbW91c2V1cCcsIHRoaXMucGFzc3dvcmRPbk1vdXNlVXBIYW5kbGVyKTtcblx0XHRcdHRoaXMuZWxlbWVudHMubGVuZ3RoLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIHRoaXMubGVuZ2hPbkNoYW5nZUhhbmRsZXIpO1xuXHRcdH1cblxuXHRcdGdlbmVyYXRlV2lkZ2V0Q29udGVudCh3aWRnZXRDb250YWluZXIpIHtcblx0XHRcdGNvbnN0IHBhc3N3b3JkID0gdGhpcy5jcmVhdGVFbGVtZW50KCdpbnB1dCcsIHtjbGFzc05hbWU6IHRoaXMuQ1NTX0NMQVNTX05BTUVTLlBBU1NXT1JELCB0eXBlOiAndGV4dCcsIHZhbHVlOiAncGFzc3dvcmQnfSk7XG5cdFx0XHR0aGlzLmVsZW1lbnRzLnBhc3N3b3JkID0gcGFzc3dvcmQ7XG5cdFx0XHRjb25zdCBwYXNzd29yZENvbnRhaW5lciA9IHRoaXMuY3JlYXRlRWxlbWVudCgnZGl2Jywge2NsYXNzTmFtZTogdGhpcy5DU1NfQ0xBU1NfTkFNRVMuUEFTU1dPUkRfQ09OVEFJTkVSfSwgW3Bhc3N3b3JkXSk7XG5cdFx0XHRjb25zdCBnZW5lcmF0ZUJ1dHRvbiA9IHRoaXMuY3JlYXRlRWxlbWVudCgnaW5wdXQnLCB7Y2xhc3NOYW1lOiB0aGlzLkNTU19DTEFTU19OQU1FUy5CVVRUT04sIHR5cGU6ICdidXR0b24nLCB2YWx1ZTogJ2dlbmVyYXRlJ30pO1xuXHRcdFx0dGhpcy5lbGVtZW50cy5idXR0b24gPSBnZW5lcmF0ZUJ1dHRvbjtcblx0XHRcdGNvbnN0IGxlbmd0aCA9IHRoaXMuZ2VuZXJhdGVMZW5ndGhFbGVtZW50KCk7XG5cdFx0XHR0aGlzLmVsZW1lbnRzLmxlbmd0aCA9IGxlbmd0aDtcblx0XHRcdGNvbnN0IGxlbmd0aENvbnRhaW5lciA9IHRoaXMuY3JlYXRlRWxlbWVudCgnZGl2Jywge2NsYXNzTmFtZTogdGhpcy5DU1NfQ0xBU1NfTkFNRVMuTEVOR1RIX0NPTlRBSU5FUn0sIFtsZW5ndGhdKTtcblx0XHRcdGNvbnN0IGNoYXJzZXRMaXN0ID0gdGhpcy5nZW5lcmF0ZUNoYXJzZXRMaXN0RWxlbWVudCgpO1xuXHRcdFx0dGhpcy5lbGVtZW50cy5jaGFyc2V0TGlzdCA9IGNoYXJzZXRMaXN0O1xuXHRcdFx0Y29uc3Qgd2lkZ2V0ID0gdGhpcy5jcmVhdGVFbGVtZW50KCdkaXYnLCB7Y2xhc3NOYW1lOiBgJHt0aGlzLkNTU19DTEFTU19OQU1FUy5QQVNTV09SRF9HRU5FUkFUT1J9ICR7dGhpcy5DU1NfQ0xBU1NfTkFNRVMuQ0xFQVJGSVh9YH0sXG5cdFx0XHRcdFtwYXNzd29yZENvbnRhaW5lciwgZ2VuZXJhdGVCdXR0b24sIGxlbmd0aENvbnRhaW5lciwgY2hhcnNldExpc3RdKTtcblx0XHRcdHdpZGdldENvbnRhaW5lci5hcHBlbmRDaGlsZCh3aWRnZXQpO1xuXHRcdFx0cmV0dXJuIHdpZGdldDtcblx0XHR9XG5cblx0XHQvL2NvcGllcyBwYXNzd29yZCB0byBjbGlwYm9hcmRcblx0XHRwYXNzd29yZE9uTW91c2VVcEhhbmRsZXIgPSAoZSkgPT4ge1xuXHRcdFx0Y29uc3QgZWxlbSA9IGUudGFyZ2V0O1xuXG5cdFx0XHQvLyBzZWxlY3RzIHBhc3N3b3JkIGFuZCBjb3B5IGl0IHRvIGNsaXBib2FyZFxuXHRcdFx0Ly8gZG9lcyBub3Qgd29yayBvbiBpT1MgZGV2aWNlc1xuXHRcdFx0ZWxlbS5zZXRTZWxlY3Rpb25SYW5nZSgwLCBlbGVtLnZhbHVlLmxlbmd0aCk7XG5cdFx0XHRkb2N1bWVudC5leGVjQ29tbWFuZCgnY29weScpO1xuXHRcdH07XG5cblx0XHQvL3Nob3dzIFwiY29waWVkXCIgbm90aWZpY2F0aW9uXG5cdFx0b25Db3B5RXZlbnRIYW5kbGVyID0gKGV2ZW50KSA9PiB7XG5cdFx0XHRpZiAodGhpcy5lbGVtZW50cy50b29sdGlwKSB7IHJldHVybjsgfVxuXG5cdFx0XHQvL2NyZWF0ZXMgbm90aWZpY2F0aW9uIG1lc3NhZ2Vcblx0XHRcdGNvbnN0IHRvb2x0aXAgPSB0aGlzLmNyZWF0ZUVsZW1lbnQoJ2RpdicsIHtjbGFzc05hbWU6IHRoaXMuQ1NTX0NMQVNTX05BTUVTLlRPT0xUSVB9LCBbdGhpcy5NRVNTQUdFUy5QQVNTV09SRF9DT1BJRURdKTtcblx0XHRcdHRoaXMuZWxlbWVudHMudG9vbHRpcCA9IHRvb2x0aXA7XG5cdFx0XHRjb25zdCBwYXNzd29yZEVsZW0gPSB0aGlzLmVsZW1lbnRzLnBhc3N3b3JkO1xuXHRcdFx0cGFzc3dvcmRFbGVtLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKHRvb2x0aXAsIHBhc3N3b3JkRWxlbS5uZXh0U2libGluZylcblxuXHRcdFx0Ly9zZXRzIGEgbm90aWZpY2F0aW9uIGRpc3BsYXkgdGltZW91dFxuXHRcdFx0c2V0VGltZW91dCgoKSA9PiB7IHRvb2x0aXAucmVtb3ZlKCk7IHRoaXMuZWxlbWVudHMudG9vbHRpcCA9IG51bGw7IH0sIHRoaXMuQ09OU1RBTlRTLkRFTEFZKTtcblx0XHR9O1xuXG5cdFx0bGVuZ2hPbkNoYW5nZUhhbmRsZXIgPSAoZXZlbnQpID0+IHtcblx0XHRcdGNvbnN0IGVsZW0gPSBldmVudC50YXJnZXQ7XG5cdFx0XHR0aGlzLmxlbmd0aCA9IHBhcnNlSW50KGVsZW0udmFsdWUpO1xuXHRcdH07XG5cblx0XHRnZXRDaGFyc2V0TGlzdCgpIHtcblx0XHRcdGxldCBsaXN0ID0gdGhpcy5lbGVtZW50cy5jaGFyc2V0TGlzdC5pdGVtcy5zbGljZSgpIHx8IFtdO1xuXHRcdFx0bGlzdCA9IGxpc3QuZmlsdGVyKGl0ZW0gPT4gaXRlbS5jaGVja2VkKS5tYXAoaXRlbSA9PiBpdGVtLm5hbWUpO1xuXHRcdFx0cmV0dXJuIGxpc3Q7XG5cdFx0fVxuXG5cdFx0Z2VuZXJhdGVMZW5ndGhFbGVtZW50KCkge1xuXHRcdFx0Y29uc3QgY29udGFpbmVyID0gdGhpcy5jcmVhdGVFbGVtZW50KCdzZWxlY3QnLCB7Y2xhc3NOYW1lOiB0aGlzLkNTU19DTEFTU19OQU1FUy5MRU5HVEh9KTtcblxuXHRcdFx0Zm9yIChsZXQgbCA9IDA7IGwgPD0gdGhpcy5tYXhMZW5ndGggLSB0aGlzLm1pbkxlbmd0aDsgbCsrKSB7XG5cdFx0XHRcdGNvbnN0IHZhbHVlID0gbCArIHRoaXMubWluTGVuZ3RoO1xuXHRcdFx0XHRjb25zdCBvcHRpb24gPSB0aGlzLmNyZWF0ZUVsZW1lbnQoJ29wdGlvbicsIHt2YWx1ZTogdmFsdWUsIGlubmVySFRNTDogdmFsdWUsIHNlbGVjdGVkOiB2YWx1ZSA9PT0gdGhpcy5sZW5ndGggPyB0cnVlIDogZmFsc2V9KTtcblx0XHRcdFx0Y29udGFpbmVyLmFwcGVuZENoaWxkKG9wdGlvbik7XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBjb250YWluZXI7XG5cdFx0fVxuXG5cdFx0Z2VuZXJhdGVDaGFyc2V0TGlzdEVsZW1lbnQoKSB7XG5cdFx0XHRjb25zdCBjb250YWluZXIgPSB0aGlzLmNyZWF0ZUVsZW1lbnQoJ2RpdicsIHtjbGFzc05hbWU6IHRoaXMuQ1NTX0NMQVNTX05BTUVTLkNIQVJTRVRfTElTVCwgaXRlbXM6IFtdfSk7XG5cdFx0XHRjb25zdCBjaGFyc2V0ID0gdGhpcy5jaGFyc2V0O1xuXG5cdFx0XHRmb3IgKGxldCBzdHIgaW4gY2hhcnNldCl7XG5cdFx0XHRcdGNvbnN0IGlucHV0ID0gdGhpcy5jcmVhdGVFbGVtZW50KCdpbnB1dCcsIHtjbGFzc05hbWU6IHRoaXMuQ1NTX0NMQVNTX05BTUVTLkNIQVJTRVRfTElTVF9DSEVDS0JPWCwgdHlwZTogJ2NoZWNrYm94JywgbmFtZTogc3RyLCB2YWx1ZTogc3RyLCBjaGVja2VkOiB0aGlzLmNoYXJUeXBlcy5pbmNsdWRlcyhzdHIpID8gdHJ1ZSA6IGZhbHNlfSk7XG5cdFx0XHRcdGNvbnN0IGxhYmVsID0gdGhpcy5jcmVhdGVFbGVtZW50KCdsYWJlbCcsIHtjbGFzc05hbWU6IHRoaXMuQ1NTX0NMQVNTX05BTUVTLkNIQVJTRVRfTElTVF9MQUJFTH0sIFtpbnB1dCwgc3RyXSk7XG5cdFx0XHRcdGNvbnRhaW5lci5pdGVtcy5wdXNoKGlucHV0KTtcblx0XHRcdFx0Y29udGFpbmVyLmFwcGVuZENoaWxkKGxhYmVsKTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIGNvbnRhaW5lcjtcblx0XHR9XG5cblx0XHRidXR0b25DbGlja0hhbmRsZXIgPSAoZSkgPT4ge1xuXHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0dGhpcy5lbGVtZW50cy5wYXNzd29yZC52YWx1ZSA9IHRoaXMuY29yZS5nZW5lcmF0ZVBhc3N3b3JkKHRoaXMubGVuZ3RoLCB0aGlzLmdldENoYXJzZXRMaXN0KCkpO1xuXHRcdH07XG5cdH1cblxuXHR3aW5kb3cuUGFzc3dvcmRHZW5lcmF0b3JXaWRnZXQgPSBQYXNzd29yZEdlbmVyYXRvcldpZGdldDtcbn0pKCk7XG4iXX0=
