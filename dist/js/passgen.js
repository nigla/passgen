'use strict';

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

;(function () {
	"use strict";

	var PasswordGeneratorCore = function () {
		function PasswordGeneratorCore() {
			_classCallCheck(this, PasswordGeneratorCore);
		}

		_createClass(PasswordGeneratorCore, null, [{
			key: 'getRandomChar',
			value: function getRandomChar(selectedCharTypes) {
				var types = selectedCharTypes && selectedCharTypes.length && selectedCharTypes || this.presets.charTypes;
				var randomCharType = types[Math.floor(Math.random() * types.length)];
				var charsetByType = this.presets.charset[randomCharType];
				var randomChar = charsetByType[Math.floor(Math.random() * charsetByType.length)];
				return randomChar;
			}
		}, {
			key: 'generatePassword',
			value: function generatePassword(len, selectedCharTypes) {
				var _this = this;

				len = len || this.presets.length;
				if (len > this.presets.maxLength) {
					len = this.presets.maxLength;
				}
				if (len < this.presets.minLength) {
					len = this.presets.minLength;
				}
				return Array.from(Array(len), function () {
					return _this.getRandomChar(selectedCharTypes);
				}).join('');
			}
		}]);

		return PasswordGeneratorCore;
	}();

	PasswordGeneratorCore.presets = {
		length: 16,
		minLength: 6,
		maxLength: 256,
		charTypes: ['numbers', 'uppercase', 'lowercase', 'special'],
		charset: {
			'numbers': '1234567890',
			'uppercase': 'ABCDEFGHIJKLMNOPQRSTUVWXYZ',
			'lowercase': 'abcdefghijklmnopqrstuvwxyz',
			'special': '!#$%&()*+,-./:;<=>?@[]^_{|}~'
		}
	};

	var PasswordGeneratorWidget = function () {
		function PasswordGeneratorWidget(options) {
			_classCallCheck(this, PasswordGeneratorWidget);

			this.CSS_CLASS_NAMES = {
				BUTTON: 'password-generator__button',
				HIDE_BUTTON: 'password-generator__hide-button',
				COPY_BUTTON: 'password-generator__copy-button',
				PASSWORD: 'password-generator__password',
				PASSWORD_CONTAINER: 'password-generator__password-container',
				LENGTH: 'password-generator__length',
				LENGTH_CONTAINER: 'password-generator__length-container',
				TOOLBAR: 'password-generator__toolbar',
				PASSWORD_GENERATOR: 'password-generator',
				CLEARFIX: 'clearfix',
				TOOLTIP: 'password-generator__tooltip',
				CHARSET_LIST: 'password-generator__charset-list'
			};
			this.SELECTORS = {
				CONTAINER: '#password-generator'
			};
			this.elements = {};
			this.CONSTANTS = { DELAY: 1000 };
			this.MESSAGES = {
				PASSWORD_COPIED: 'copied',
				HIDE: 'hide',
				SHOW: 'show'
			};

			options = options || {};
			this.core = PasswordGeneratorCore;
			this.createElement = createElement;
			this.length = options.length || this.core.presets.length;
			this.minLength = this.core.presets.minLength;
			this.maxLength = this.core.presets.maxLength;
			this.container = document.querySelector(options.selector || this.SELECTORS.CONTAINER);
			this.charset = options.charset || this.core.presets.charset;
			this.widget = this.generateWidgetContent(this.container);
			this.assignListeners();
			this.elements.password.value = this.core.generatePassword(this.length);
		}

		_createClass(PasswordGeneratorWidget, [{
			key: 'assignListeners',
			value: function assignListeners() {
				this.elements.button.addEventListener('click', this.buttonClickHandler.bind(this));
				//shows notification after password was copied
				this.widget.addEventListener('copy', this.onCopyEventHandler.bind(this));
				this.elements.password.addEventListener('mouseup', this.passwordOnMouseUpHandler.bind(this));
				this.elements.length.addEventListener('change', this.lenghOnChangeHandler.bind(this));
			}
		}, {
			key: 'generateWidgetContent',
			value: function generateWidgetContent(widgetContainer) {
				// const widgetContainer = document.querySelector(id);
				var password = this.createElement('input', { className: this.CSS_CLASS_NAMES.PASSWORD, type: 'text', value: 'password' });
				this.elements.password = password;
				var passwordContainer = this.createElement('div', { className: this.CSS_CLASS_NAMES.PASSWORD_CONTAINER }, [password]);
				var generateButton = this.createElement('input', { className: this.CSS_CLASS_NAMES.BUTTON, type: 'button', value: 'generate' });
				this.elements.button = generateButton;
				var toolbarContainer = this.createElement('div', { className: this.CSS_CLASS_NAMES.TOOLBAR }, [generateButton]);
				var length = this.generateLengthElement();
				var lengthContainer = this.createElement('div', { className: this.CSS_CLASS_NAMES.LENGTH_CONTAINER }, [length]);
				this.elements.length = length;
				var charsetList = this.generateCharsetListElement();
				this.elements.charsetList = charsetList;
				var widget = this.createElement('div', { className: this.CSS_CLASS_NAMES.PASSWORD_GENERATOR + ' ' + this.CSS_CLASS_NAMES.CLEARFIX }, [passwordContainer, toolbarContainer, lengthContainer, charsetList]);
				widgetContainer.appendChild(widget);
				return widget;
			}

			//copies password to clipboard

		}, {
			key: 'passwordOnMouseUpHandler',
			value: function passwordOnMouseUpHandler(e) {
				var elem = e.target;

				// selects password and copy it to clipboard
				// does not work on iOS devices
				elem.setSelectionRange(0, elem.value.length);
				document.execCommand('copy');
			}

			//shows "copied" notification

		}, {
			key: 'onCopyEventHandler',
			value: function onCopyEventHandler(event) {
				var _this2 = this;

				if (this.elements.tooltip) {
					return;
				}

				//creates notification message
				var tooltip = this.createElement('div', { className: this.CSS_CLASS_NAMES.TOOLTIP }, [this.MESSAGES.PASSWORD_COPIED]);
				this.elements.tooltip = tooltip;
				var passwordElem = this.elements.password;
				passwordElem.parentNode.insertBefore(tooltip, passwordElem.nextSibling);

				//sets a notification display timeout
				setTimeout(function () {
					tooltip.remove();_this2.elements.tooltip = null;
				}, this.CONSTANTS.DELAY);
			}
		}, {
			key: 'lenghOnChangeHandler',
			value: function lenghOnChangeHandler(event) {
				var elem = event.target;
				this.length = parseInt(elem.value);
			}
		}, {
			key: 'getCharsetList',
			value: function getCharsetList() {
				var list = this.elements.charsetList.items.slice() || [];
				list = list.filter(function (item) {
					return item.checked;
				}).map(function (item) {
					return item.name;
				});
				return list;
			}
		}, {
			key: 'generateLengthElement',
			value: function generateLengthElement() {
				var container = this.createElement('select', { className: this.CSS_CLASS_NAMES.LENGTH });

				for (var l = 0; l <= this.maxLength - this.minLength; l++) {
					var value = l + this.minLength;
					var option = this.createElement('option', { value: value, innerHTML: value, selected: value === this.length ? true : false });
					container.appendChild(option);
				}

				return container;
			}
		}, {
			key: 'generateCharsetListElement',
			value: function generateCharsetListElement() {
				var container = this.createElement('div', { className: this.CSS_CLASS_NAMES.CHARSET_LIST, items: [] });
				var charset = this.charset;

				for (var str in charset) {
					var input = this.createElement('input', { type: 'checkbox', name: str, value: str, checked: true });
					var label = this.createElement('label', {}, [input, str]);
					container.items.push(input);
					container.appendChild(label);
				}

				return container;
			}
		}, {
			key: 'buttonClickHandler',
			value: function buttonClickHandler(e) {
				e.preventDefault();
				this.elements.password.value = this.core.generatePassword(this.length, this.getCharsetList());
			}
		}]);

		return PasswordGeneratorWidget;
	}();

	window.PasswordGeneratorWidget = PasswordGeneratorWidget;
})();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImpzL3Bhc3NnZW4uanMiXSwibmFtZXMiOlsiUGFzc3dvcmRHZW5lcmF0b3JDb3JlIiwic2VsZWN0ZWRDaGFyVHlwZXMiLCJ0eXBlcyIsImxlbmd0aCIsInByZXNldHMiLCJjaGFyVHlwZXMiLCJyYW5kb21DaGFyVHlwZSIsIk1hdGgiLCJmbG9vciIsInJhbmRvbSIsImNoYXJzZXRCeVR5cGUiLCJjaGFyc2V0IiwicmFuZG9tQ2hhciIsImxlbiIsIm1heExlbmd0aCIsIm1pbkxlbmd0aCIsIkFycmF5IiwiZnJvbSIsImdldFJhbmRvbUNoYXIiLCJqb2luIiwiUGFzc3dvcmRHZW5lcmF0b3JXaWRnZXQiLCJvcHRpb25zIiwiQ1NTX0NMQVNTX05BTUVTIiwiQlVUVE9OIiwiSElERV9CVVRUT04iLCJDT1BZX0JVVFRPTiIsIlBBU1NXT1JEIiwiUEFTU1dPUkRfQ09OVEFJTkVSIiwiTEVOR1RIIiwiTEVOR1RIX0NPTlRBSU5FUiIsIlRPT0xCQVIiLCJQQVNTV09SRF9HRU5FUkFUT1IiLCJDTEVBUkZJWCIsIlRPT0xUSVAiLCJDSEFSU0VUX0xJU1QiLCJTRUxFQ1RPUlMiLCJDT05UQUlORVIiLCJlbGVtZW50cyIsIkNPTlNUQU5UUyIsIkRFTEFZIiwiTUVTU0FHRVMiLCJQQVNTV09SRF9DT1BJRUQiLCJISURFIiwiU0hPVyIsImNvcmUiLCJjcmVhdGVFbGVtZW50IiwiY29udGFpbmVyIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwic2VsZWN0b3IiLCJ3aWRnZXQiLCJnZW5lcmF0ZVdpZGdldENvbnRlbnQiLCJhc3NpZ25MaXN0ZW5lcnMiLCJwYXNzd29yZCIsInZhbHVlIiwiZ2VuZXJhdGVQYXNzd29yZCIsImJ1dHRvbiIsImFkZEV2ZW50TGlzdGVuZXIiLCJidXR0b25DbGlja0hhbmRsZXIiLCJiaW5kIiwib25Db3B5RXZlbnRIYW5kbGVyIiwicGFzc3dvcmRPbk1vdXNlVXBIYW5kbGVyIiwibGVuZ2hPbkNoYW5nZUhhbmRsZXIiLCJ3aWRnZXRDb250YWluZXIiLCJjbGFzc05hbWUiLCJ0eXBlIiwicGFzc3dvcmRDb250YWluZXIiLCJnZW5lcmF0ZUJ1dHRvbiIsInRvb2xiYXJDb250YWluZXIiLCJnZW5lcmF0ZUxlbmd0aEVsZW1lbnQiLCJsZW5ndGhDb250YWluZXIiLCJjaGFyc2V0TGlzdCIsImdlbmVyYXRlQ2hhcnNldExpc3RFbGVtZW50IiwiYXBwZW5kQ2hpbGQiLCJlIiwiZWxlbSIsInRhcmdldCIsInNldFNlbGVjdGlvblJhbmdlIiwiZXhlY0NvbW1hbmQiLCJldmVudCIsInRvb2x0aXAiLCJwYXNzd29yZEVsZW0iLCJwYXJlbnROb2RlIiwiaW5zZXJ0QmVmb3JlIiwibmV4dFNpYmxpbmciLCJzZXRUaW1lb3V0IiwicmVtb3ZlIiwicGFyc2VJbnQiLCJsaXN0IiwiaXRlbXMiLCJzbGljZSIsImZpbHRlciIsIml0ZW0iLCJjaGVja2VkIiwibWFwIiwibmFtZSIsImwiLCJvcHRpb24iLCJpbm5lckhUTUwiLCJzZWxlY3RlZCIsInN0ciIsImlucHV0IiwibGFiZWwiLCJwdXNoIiwicHJldmVudERlZmF1bHQiLCJnZXRDaGFyc2V0TGlzdCIsIndpbmRvdyJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUEsQ0FBRSxDQUFDLFlBQVk7QUFDZDs7QUFEYyxLQUdSQSxxQkFIUTtBQUFBO0FBQUE7QUFBQTs7QUFBQTtBQUFBO0FBQUEsaUNBaUJTQyxpQkFqQlQsRUFpQjRCO0FBQ3ZDLFFBQU1DLFFBQVFELHFCQUFxQkEsa0JBQWtCRSxNQUF2QyxJQUFpREYsaUJBQWpELElBQXNFLEtBQUtHLE9BQUwsQ0FBYUMsU0FBakc7QUFDQSxRQUFNQyxpQkFBaUJKLE1BQU1LLEtBQUtDLEtBQUwsQ0FBV0QsS0FBS0UsTUFBTCxLQUFnQlAsTUFBTUMsTUFBakMsQ0FBTixDQUF2QjtBQUNBLFFBQU1PLGdCQUFnQixLQUFLTixPQUFMLENBQWFPLE9BQWIsQ0FBcUJMLGNBQXJCLENBQXRCO0FBQ0EsUUFBTU0sYUFBYUYsY0FBY0gsS0FBS0MsS0FBTCxDQUFXRCxLQUFLRSxNQUFM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LElBQWhCLENBQXFCRixLQUFyQjtBQUNBdkQsZUFBVTJCLFdBQVYsQ0FBc0I2QixLQUF0QjtBQUNBOztBQUVELFdBQU94RCxTQUFQO0FBQ0E7QUFuS1k7QUFBQTtBQUFBLHNDQXFLTzRCLENBcktQLEVBcUtVO0FBQ3RCQSxNQUFFOEIsY0FBRjtBQUNBLFNBQUtuRSxRQUFMLENBQWNnQixRQUFkLENBQXVCQyxLQUF2QixHQUErQixLQUFLVixJQUFMLENBQVVXLGdCQUFWLENBQTJCLEtBQUtwRCxNQUFoQyxFQUF3QyxLQUFLc0csY0FBTCxFQUF4QyxDQUEvQjtBQUNBO0FBeEtZOztBQUFBO0FBQUE7O0FBMktkQyxRQUFPdEYsdUJBQVAsR0FBaUNBLHVCQUFqQztBQUNBLENBNUtDIiwiZmlsZSI6ImpzL3Bhc3NnZW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyI7IChmdW5jdGlvbiAoKSB7XG5cdFwidXNlIHN0cmljdFwiO1xuXG5cdGNsYXNzIFBhc3N3b3JkR2VuZXJhdG9yQ29yZSB7XG5cdFx0XHRzdGF0aWMgcHJlc2V0cyA9IHtcblx0XHRcdFx0bGVuZ3RoOiAxNixcblx0XHRcdFx0bWluTGVuZ3RoOiA2LFxuXHRcdFx0XHRtYXhMZW5ndGg6IDI1Nixcblx0XHRcdFx0Y2hhclR5cGVzOiBbJ251bWJlcnMnLCAndXBwZXJjYXNlJywgJ2xvd2VyY2FzZScsICdzcGVjaWFsJ10sXG5cdFx0XHRcdGNoYXJzZXQ6IHtcblx0XHRcdFx0XHQnbnVtYmVycyc6ICcxMjM0NTY3ODkwJyxcblx0XHRcdFx0XHQndXBwZXJjYXNlJzogJ0FCQ0RFRkdISUpLTE1OT1BRUlNUVVZXWFlaJyxcblx0XHRcdFx0XHQnbG93ZXJjYXNlJzogJ2FiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6Jyxcblx0XHRcdFx0XHQnc3BlY2lhbCc6ICchIyQlJigpKissLS4vOjs8PT4/QFtdXl97fH1+J1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdHN0YXRpYyBnZXRSYW5kb21DaGFyKHNlbGVjdGVkQ2hhclR5cGVzKSB7XG5cdFx0XHRcdGNvbnN0IHR5cGVzID0gc2VsZWN0ZWRDaGFyVHlwZXMgJiYgc2VsZWN0ZWRDaGFyVHlwZXMubGVuZ3RoICYmIHNlbGVjdGVkQ2hhclR5cGVzIHx8IHRoaXMucHJlc2V0cy5jaGFyVHlwZXM7XG5cdFx0XHRcdGNvbnN0IHJhbmRvbUNoYXJUeXBlID0gdHlwZXNbTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogdHlwZXMubGVuZ3RoKV07XG5cdFx0XHRcdGNvbnN0IGNoYXJzZXRCeVR5cGUgPSB0aGlzLnByZXNldHMuY2hhcnNldFtyYW5kb21DaGFyVHlwZV07XG5cdFx0XHRcdGNvbnN0IHJhbmRvbUNoYXIgPSBjaGFyc2V0QnlUeXBlW01hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIGNoYXJzZXRCeVR5cGUubGVuZ3RoKV07XG5cdFx0XHRcdHJldHVybiByYW5kb21DaGFyO1xuXHRcdFx0fVxuXG5cdFx0XHRzdGF0aWMgZ2VuZXJhdGVQYXNzd29yZCAobGVuLCBzZWxlY3RlZENoYXJUeXBlcykge1xuXHRcdFx0XHRsZW4gPSBsZW4gfHwgdGhpcy5wcmVzZXRzLmxlbmd0aDtcblx0XHRcdFx0aWYgKGxlbiA+IHRoaXMucHJlc2V0cy5tYXhMZW5ndGgpIHsgbGVuID0gdGhpcy5wcmVzZXRzLm1heExlbmd0aDsgfVxuXHRcdFx0XHRpZiAobGVuIDwgdGhpcy5wcmVzZXRzLm1pbkxlbmd0aCkgeyBsZW4gPSB0aGlzLnByZXNldHMubWluTGVuZ3RoOyB9XG5cdFx0XHRcdHJldHVybiBBcnJheS5mcm9tKEFycmF5KGxlbiksICgpID0+IHRoaXMuZ2V0UmFuZG9tQ2hhcihzZWxlY3RlZENoYXJUeXBlcykpLmpvaW4oJycpO1xuXHRcdFx0fVxuXHR9XG5cblx0Y2xhc3MgUGFzc3dvcmRHZW5lcmF0b3JXaWRnZXQge1xuXHRcdENTU19DTEFTU19OQU1FUyA9IHtcblx0XHRcdEJVVFRPTjogJ3Bhc3N3b3JkLWdlbmVyYXRvcl9fYnV0dG9uJyxcblx0XHRcdEhJREVfQlVUVE9OOiAncGFzc3dvcmQtZ2VuZXJhdG9yX19oaWRlLWJ1dHRvbicsXG5cdFx0XHRDT1BZX0JVVFRPTjogJ3Bhc3N3b3JkLWdlbmVyYXRvcl9fY29weS1idXR0b24nLFxuXHRcdFx0UEFTU1dPUkQ6ICdwYXNzd29yZC1nZW5lcmF0b3JfX3Bhc3N3b3JkJyxcblx0XHRcdFBBU1NXT1JEX0NPTlRBSU5FUjogJ3Bhc3N3b3JkLWdlbmVyYXRvcl9fcGFzc3dvcmQtY29udGFpbmVyJyxcblx0XHRcdExFTkdUSDogJ3Bhc3N3b3JkLWdlbmVyYXRvcl9fbGVuZ3RoJyxcblx0XHRcdExFTkdUSF9DT05UQUlORVI6ICdwYXNzd29yZC1nZW5lcmF0b3JfX2xlbmd0aC1jb250YWluZXInLFxuXHRcdFx0VE9PTEJBUjogJ3Bhc3N3b3JkLWdlbmVyYXRvcl9fdG9vbGJhcicsXG5cdFx0XHRQQVNTV09SRF9HRU5FUkFUT1I6ICdwYXNzd29yZC1nZW5lcmF0b3InLFxuXHRcdFx0Q0xFQVJGSVg6ICdjbGVhcmZpeCcsXG5cdFx0XHRUT09MVElQOiAncGFzc3dvcmQtZ2VuZXJhdG9yX190b29sdGlwJyxcblx0XHRcdENIQVJTRVRfTElTVDogJ3Bhc3N3b3JkLWdlbmVyYXRvcl9fY2hhcnNldC1saXN0Jyxcblx0XHR9O1xuXG5cdFx0U0VMRUNUT1JTID0ge1xuXHRcdFx0Q09OVEFJTkVSOiAnI3Bhc3N3b3JkLWdlbmVyYXRvcicsXG5cdFx0fTtcblxuXHRcdGVsZW1lbnRzID0ge307XG5cblx0XHRDT05TVEFOVFMgPSB7REVMQVk6IDEwMDB9O1xuXG5cdFx0TUVTU0FHRVMgPSB7XG5cdFx0XHRQQVNTV09SRF9DT1BJRUQ6ICdjb3BpZWQnLFxuXHRcdFx0SElERTogJ2hpZGUnLFxuXHRcdFx0U0hPVzogJ3Nob3cnLFxuXHRcdH07XG5cblx0XHRjb25zdHJ1Y3RvcihvcHRpb25zKXtcblx0XHRcdG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xuXHRcdFx0dGhpcy5jb3JlID0gUGFzc3dvcmRHZW5lcmF0b3JDb3JlO1xuXHRcdFx0dGhpcy5jcmVhdGVFbGVtZW50ID0gY3JlYXRlRWxlbWVudDtcblx0XHRcdHRoaXMubGVuZ3RoID0gb3B0aW9ucy5sZW5ndGggfHwgdGhpcy5jb3JlLnByZXNldHMubGVuZ3RoO1xuXHRcdFx0dGhpcy5taW5MZW5ndGggPSB0aGlzLmNvcmUucHJlc2V0cy5taW5MZW5ndGg7XG5cdFx0XHR0aGlzLm1heExlbmd0aCA9IHRoaXMuY29yZS5wcmVzZXRzLm1heExlbmd0aDtcblx0XHRcdHRoaXMuY29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihvcHRpb25zLnNlbGVjdG9yIHx8IHRoaXMuU0VMRUNUT1JTLkNPTlRBSU5FUik7XG5cdFx0XHR0aGlzLmNoYXJzZXQgPSBvcHRpb25zLmNoYXJzZXQgfHwgdGhpcy5jb3JlLnByZXNldHMuY2hhcnNldDtcblx0XHRcdHRoaXMud2lkZ2V0ID0gdGhpcy5nZW5lcmF0ZVdpZGdldENvbnRlbnQodGhpcy5jb250YWluZXIpO1xuXHRcdFx0dGhpcy5hc3NpZ25MaXN0ZW5lcnMoKTtcblx0XHRcdHRoaXMuZWxlbWVudHMucGFzc3dvcmQudmFsdWUgPSB0aGlzLmNvcmUuZ2VuZXJhdGVQYXNzd29yZCh0aGlzLmxlbmd0aCk7XG5cdFx0fVxuXG5cdFx0YXNzaWduTGlzdGVuZXJzKCkge1xuXHRcdFx0dGhpcy5lbGVtZW50cy5idXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLmJ1dHRvbkNsaWNrSGFuZGxlci5iaW5kKHRoaXMpKTtcblx0XHRcdC8vc2hvd3Mgbm90aWZpY2F0aW9uIGFmdGVyIHBhc3N3b3JkIHdhcyBjb3BpZWRcblx0XHRcdHRoaXMud2lkZ2V0LmFkZEV2ZW50TGlzdGVuZXIoJ2NvcHknLCB0aGlzLm9uQ29weUV2ZW50SGFuZGxlci5iaW5kKHRoaXMpKTtcblx0XHRcdHRoaXMuZWxlbWVudHMucGFzc3dvcmQuYWRkRXZlbnRMaXN0ZW5lcignbW91c2V1cCcsIHRoaXMucGFzc3dvcmRPbk1vdXNlVXBIYW5kbGVyLmJpbmQodGhpcykpO1xuXHRcdFx0dGhpcy5lbGVtZW50cy5sZW5ndGguYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgdGhpcy5sZW5naE9uQ2hhbmdlSGFuZGxlci5iaW5kKHRoaXMpKTtcblx0XHR9XG5cblx0XHRnZW5lcmF0ZVdpZGdldENvbnRlbnQod2lkZ2V0Q29udGFpbmVyKSB7XG5cdFx0XHQvLyBjb25zdCB3aWRnZXRDb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGlkKTtcblx0XHRcdGNvbnN0IHBhc3N3b3JkID0gdGhpcy5jcmVhdGVFbGVtZW50KCdpbnB1dCcsIHtjbGFzc05hbWU6IHRoaXMuQ1NTX0NMQVNTX05BTUVTLlBBU1NXT1JELCB0eXBlOiAndGV4dCcsIHZhbHVlOiAncGFzc3dvcmQnfSk7XG5cdFx0XHR0aGlzLmVsZW1lbnRzLnBhc3N3b3JkID0gcGFzc3dvcmQ7XG5cdFx0XHRjb25zdCBwYXNzd29yZENvbnRhaW5lciA9IHRoaXMuY3JlYXRlRWxlbWVudCgnZGl2Jywge2NsYXNzTmFtZTogdGhpcy5DU1NfQ0xBU1NfTkFNRVMuUEFTU1dPUkRfQ09OVEFJTkVSfSwgW3Bhc3N3b3JkXSk7XG5cdFx0XHRjb25zdCBnZW5lcmF0ZUJ1dHRvbiA9IHRoaXMuY3JlYXRlRWxlbWVudCgnaW5wdXQnLCB7Y2xhc3NOYW1lOiB0aGlzLkNTU19DTEFTU19OQU1FUy5CVVRUT04sIHR5cGU6ICdidXR0b24nLCB2YWx1ZTogJ2dlbmVyYXRlJ30pO1xuXHRcdFx0dGhpcy5lbGVtZW50cy5idXR0b24gPSBnZW5lcmF0ZUJ1dHRvbjtcblx0XHRcdGNvbnN0IHRvb2xiYXJDb250YWluZXIgPSB0aGlzLmNyZWF0ZUVsZW1lbnQoJ2RpdicsIHtjbGFzc05hbWU6IHRoaXMuQ1NTX0NMQVNTX05BTUVTLlRPT0xCQVJ9LCBbZ2VuZXJhdGVCdXR0b25dKTtcblx0XHRcdGNvbnN0IGxlbmd0aCA9IHRoaXMuZ2VuZXJhdGVMZW5ndGhFbGVtZW50KCk7XG5cdFx0XHRjb25zdCBsZW5ndGhDb250YWluZXIgPSB0aGlzLmNyZWF0ZUVsZW1lbnQoJ2RpdicsIHtjbGFzc05hbWU6IHRoaXMuQ1NTX0NMQVNTX05BTUVTLkxFTkdUSF9DT05UQUlORVJ9LCBbbGVuZ3RoXSk7XG5cdFx0XHR0aGlzLmVsZW1lbnRzLmxlbmd0aCA9IGxlbmd0aDtcblx0XHRcdGNvbnN0IGNoYXJzZXRMaXN0ID0gdGhpcy5nZW5lcmF0ZUNoYXJzZXRMaXN0RWxlbWVudCgpO1xuXHRcdFx0dGhpcy5lbGVtZW50cy5jaGFyc2V0TGlzdCA9IGNoYXJzZXRMaXN0O1xuXHRcdFx0Y29uc3Qgd2lkZ2V0ID0gdGhpcy5jcmVhdGVFbGVtZW50KCdkaXYnLCB7Y2xhc3NOYW1lOiBgJHt0aGlzLkNTU19DTEFTU19OQU1FUy5QQVNTV09SRF9HRU5FUkFUT1J9ICR7dGhpcy5DU1NfQ0xBU1NfTkFNRVMuQ0xFQVJGSVh9YH0sXG5cdFx0XHRcdFtwYXNzd29yZENvbnRhaW5lciwgdG9vbGJhckNvbnRhaW5lciwgbGVuZ3RoQ29udGFpbmVyLCBjaGFyc2V0TGlzdF0pO1xuXHRcdFx0d2lkZ2V0Q29udGFpbmVyLmFwcGVuZENoaWxkKHdpZGdldCk7XG5cdFx0XHRyZXR1cm4gd2lkZ2V0O1xuXHRcdH1cblxuXHRcdC8vY29waWVzIHBhc3N3b3JkIHRvIGNsaXBib2FyZFxuXHRcdHBhc3N3b3JkT25Nb3VzZVVwSGFuZGxlcihlKSB7XG5cdFx0XHRjb25zdCBlbGVtID0gZS50YXJnZXQ7XG5cblx0XHRcdC8vIHNlbGVjdHMgcGFzc3dvcmQgYW5kIGNvcHkgaXQgdG8gY2xpcGJvYXJkXG5cdFx0XHQvLyBkb2VzIG5vdCB3b3JrIG9uIGlPUyBkZXZpY2VzXG5cdFx0XHRlbGVtLnNldFNlbGVjdGlvblJhbmdlKDAsIGVsZW0udmFsdWUubGVuZ3RoKTtcblx0XHRcdGRvY3VtZW50LmV4ZWNDb21tYW5kKCdjb3B5Jyk7XG5cdFx0fVxuXG5cdFx0Ly9zaG93cyBcImNvcGllZFwiIG5vdGlmaWNhdGlvblxuXHRcdG9uQ29weUV2ZW50SGFuZGxlciAoZXZlbnQpIHtcblx0XHRcdGlmICh0aGlzLmVsZW1lbnRzLnRvb2x0aXApIHsgcmV0dXJuOyB9XG5cblx0XHRcdC8vY3JlYXRlcyBub3RpZmljYXRpb24gbWVzc2FnZVxuXHRcdFx0Y29uc3QgdG9vbHRpcCA9IHRoaXMuY3JlYXRlRWxlbWVudCgnZGl2Jywge2NsYXNzTmFtZTogdGhpcy5DU1NfQ0xBU1NfTkFNRVMuVE9PTFRJUH0sIFt0aGlzLk1FU1NBR0VTLlBBU1NXT1JEX0NPUElFRF0pO1xuXHRcdFx0dGhpcy5lbGVtZW50cy50b29sdGlwID0gdG9vbHRpcDtcblx0XHRcdGNvbnN0IHBhc3N3b3JkRWxlbSA9IHRoaXMuZWxlbWVudHMucGFzc3dvcmQ7XG5cdFx0XHRwYXNzd29yZEVsZW0ucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUodG9vbHRpcCwgcGFzc3dvcmRFbGVtLm5leHRTaWJsaW5nKVxuXG5cdFx0XHQvL3NldHMgYSBub3RpZmljYXRpb24gZGlzcGxheSB0aW1lb3V0XG5cdFx0XHRzZXRUaW1lb3V0KCgpID0+IHsgdG9vbHRpcC5yZW1vdmUoKTsgdGhpcy5lbGVtZW50cy50b29sdGlwID0gbnVsbDsgfSwgdGhpcy5DT05TVEFOVFMuREVMQVkpO1xuXHRcdH07XG5cblx0XHRsZW5naE9uQ2hhbmdlSGFuZGxlcihldmVudCkge1xuXHRcdFx0Y29uc3QgZWxlbSA9IGV2ZW50LnRhcmdldDtcblx0XHRcdHRoaXMubGVuZ3RoID0gcGFyc2VJbnQoZWxlbS52YWx1ZSk7XG5cdFx0fVxuXG5cdFx0Z2V0Q2hhcnNldExpc3QoKSB7XG5cdFx0XHRsZXQgbGlzdCA9IHRoaXMuZWxlbWVudHMuY2hhcnNldExpc3QuaXRlbXMuc2xpY2UoKSB8fCBbXTtcblx0XHRcdGxpc3QgPSBsaXN0LmZpbHRlcihpdGVtID0+IGl0ZW0uY2hlY2tlZCkubWFwKGl0ZW0gPT4gaXRlbS5uYW1lKTtcblx0XHRcdHJldHVybiBsaXN0O1xuXHRcdH1cblxuXHRcdGdlbmVyYXRlTGVuZ3RoRWxlbWVudCgpIHtcblx0XHRcdGNvbnN0IGNvbnRhaW5lciA9IHRoaXMuY3JlYXRlRWxlbWVudCgnc2VsZWN0Jywge2NsYXNzTmFtZTogdGhpcy5DU1NfQ0xBU1NfTkFNRVMuTEVOR1RIfSk7XG5cblx0XHRcdGZvciAobGV0IGwgPSAwOyBsIDw9IHRoaXMubWF4TGVuZ3RoIC0gdGhpcy5taW5MZW5ndGg7IGwrKykge1xuXHRcdFx0XHRjb25zdCB2YWx1ZSA9IGwgKyB0aGlzLm1pbkxlbmd0aDtcblx0XHRcdFx0Y29uc3Qgb3B0aW9uID0gdGhpcy5jcmVhdGVFbGVtZW50KCdvcHRpb24nLCB7dmFsdWU6IHZhbHVlLCBpbm5lckhUTUw6IHZhbHVlLCBzZWxlY3RlZDogdmFsdWUgPT09IHRoaXMubGVuZ3RoID8gdHJ1ZSA6IGZhbHNlfSk7XG5cdFx0XHRcdGNvbnRhaW5lci5hcHBlbmRDaGlsZChvcHRpb24pO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gY29udGFpbmVyO1xuXHRcdH1cblxuXHRcdGdlbmVyYXRlQ2hhcnNldExpc3RFbGVtZW50KCkge1xuXHRcdFx0Y29uc3QgY29udGFpbmVyID0gdGhpcy5jcmVhdGVFbGVtZW50KCdkaXYnLCB7Y2xhc3NOYW1lOiB0aGlzLkNTU19DTEFTU19OQU1FUy5DSEFSU0VUX0xJU1QsIGl0ZW1zOiBbXX0pO1xuXHRcdFx0Y29uc3QgY2hhcnNldCA9IHRoaXMuY2hhcnNldDtcblxuXHRcdFx0Zm9yIChsZXQgc3RyIGluIGNoYXJzZXQpe1xuXHRcdFx0XHRjb25zdCBpbnB1dCA9IHRoaXMuY3JlYXRlRWxlbWVudCgnaW5wdXQnLCB7dHlwZTogJ2NoZWNrYm94JywgbmFtZTogc3RyLCB2YWx1ZTogc3RyLCBjaGVja2VkOiB0cnVlfSk7XG5cdFx0XHRcdGNvbnN0IGxhYmVsID0gdGhpcy5jcmVhdGVFbGVtZW50KCdsYWJlbCcsIHt9LCBbaW5wdXQsIHN0cl0pO1xuXHRcdFx0XHRjb250YWluZXIuaXRlbXMucHVzaChpbnB1dCk7XG5cdFx0XHRcdGNvbnRhaW5lci5hcHBlbmRDaGlsZChsYWJlbCk7XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBjb250YWluZXI7XG5cdFx0fVxuXG5cdFx0YnV0dG9uQ2xpY2tIYW5kbGVyIChlKSB7XG5cdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHR0aGlzLmVsZW1lbnRzLnBhc3N3b3JkLnZhbHVlID0gdGhpcy5jb3JlLmdlbmVyYXRlUGFzc3dvcmQodGhpcy5sZW5ndGgsIHRoaXMuZ2V0Q2hhcnNldExpc3QoKSk7XG5cdFx0fVxuXHR9XG5cblx0d2luZG93LlBhc3N3b3JkR2VuZXJhdG9yV2lkZ2V0ID0gUGFzc3dvcmRHZW5lcmF0b3JXaWRnZXQ7XG59KSgpO1xuIl19
