'use strict';

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

;(function () {
	"use strict";

	var PasswordGeneratorCore = function () {
		function PasswordGeneratorCore() {
			_classCallCheck(this, PasswordGeneratorCore);
		}

		_createClass(PasswordGeneratorCore, null, [{
			key: 'getRandomChar',
			value: function getRandomChar(selectedCharTypes) {
				var types = selectedCharTypes && selectedCharTypes.length && selectedCharTypes || this.presets.charTypes;
				var randomCharType = types[Math.floor(Math.random() * types.length)];
				var charsetByType = this.presets.charset[randomCharType];
				var randomChar = charsetByType[Math.floor(Math.random() * charsetByType.length)];
				return randomChar;
			}
		}, {
			key: 'generatePassword',
			value: function generatePassword(len, selectedCharTypes) {
				var _this = this;

				len = len || this.presets.length;
				if (len > this.presets.maxLength) {
					len = this.presets.maxLength;
				}
				if (len < this.presets.minLength) {
					len = this.presets.minLength;
				}
				return Array.from(Array(len), function () {
					return _this.getRandomChar(selectedCharTypes);
				}).join('');
			}
		}]);

		return PasswordGeneratorCore;
	}();

	PasswordGeneratorCore.presets = {
		length: 16,
		minLength: 6,
		maxLength: 256,
		charTypes: ['numbers', 'uppercase', 'lowercase', 'special'],
		charset: {
			'numbers': '1234567890',
			'uppercase': 'ABCDEFGHIJKLMNOPQRSTUVWXYZ',
			'lowercase': 'abcdefghijklmnopqrstuvwxyz',
			'special': '!#$%&()*+,-./:;<=>?@[]^_{|}~'
		}
	};

	var PasswordGeneratorWidget = function () {
		function PasswordGeneratorWidget(options) {
			_classCallCheck(this, PasswordGeneratorWidget);

			this.CSS_CLASS_NAMES = {
				BUTTON: 'password-generator__button',
				PASSWORD: 'password-generator__password',
				PASSWORD_CONTAINER: 'password-generator__password-container',
				LENGTH: 'password-generator__length',
				LENGTH_CONTAINER: 'password-generator__length-container',
				TOOLBAR: 'password-generator__toolbar',
				PASSWORD_GENERATOR: 'password-generator',
				CLEARFIX: 'clearfix',
				TOOLTIP: 'password-generator__tooltip',
				CHARSET_LIST: 'password-generator__charset-list'
			};
			this.SELECTORS = {
				CONTAINER: '#password-generator'
			};
			this.elements = {};
			this.CONSTANTS = { DELAY: 1000 };
			this.MESSAGES = {
				PASSWORD_COPIED: 'copied',
				HIDE: 'hide',
				SHOW: 'show'
			};

			options = options || {};
			this.core = PasswordGeneratorCore;
			this.createElement = createElement;
			this.length = options.length || this.core.presets.length;
			this.minLength = this.core.presets.minLength;
			this.maxLength = this.core.presets.maxLength;
			this.container = document.querySelector(options.selector || this.SELECTORS.CONTAINER);
			this.charset = options.charset || this.core.presets.charset;
			this.widget = this.generateWidgetContent(this.container);
			this.assignListeners();
			this.elements.password.value = this.core.generatePassword(this.length);
		}

		_createClass(PasswordGeneratorWidget, [{
			key: 'assignListeners',
			value: function assignListeners() {
				this.elements.button.addEventListener('click', this.buttonClickHandler.bind(this));
				//shows notification after password was copied
				this.widget.addEventListener('copy', this.onCopyEventHandler.bind(this));
				this.elements.password.addEventListener('mouseup', this.passwordOnMouseUpHandler.bind(this));
				this.elements.length.addEventListener('change', this.lenghOnChangeHandler.bind(this));
			}
		}, {
			key: 'generateWidgetContent',
			value: function generateWidgetContent(widgetContainer) {
				var password = this.createElement('input', { className: this.CSS_CLASS_NAMES.PASSWORD, type: 'text', value: 'password' });
				this.elements.password = password;
				var passwordContainer = this.createElement('div', { className: this.CSS_CLASS_NAMES.PASSWORD_CONTAINER }, [password]);
				var generateButton = this.createElement('input', { className: this.CSS_CLASS_NAMES.BUTTON, type: 'button', value: 'generate' });
				this.elements.button = generateButton;
				var length = this.generateLengthElement();
				this.elements.length = length;
				var lengthContainer = this.createElement('div', { className: this.CSS_CLASS_NAMES.LENGTH_CONTAINER }, [length]);
				var charsetList = this.generateCharsetListElement();
				this.elements.charsetList = charsetList;
				var widget = this.createElement('div', { className: this.CSS_CLASS_NAMES.PASSWORD_GENERATOR + ' ' + this.CSS_CLASS_NAMES.CLEARFIX }, [passwordContainer, generateButton, lengthContainer, charsetList]);
				widgetContainer.appendChild(widget);
				return widget;
			}

			//copies password to clipboard

		}, {
			key: 'passwordOnMouseUpHandler',
			value: function passwordOnMouseUpHandler(e) {
				var elem = e.target;

				// selects password and copy it to clipboard
				// does not work on iOS devices
				elem.setSelectionRange(0, elem.value.length);
				document.execCommand('copy');
			}

			//shows "copied" notification

		}, {
			key: 'onCopyEventHandler',
			value: function onCopyEventHandler(event) {
				var _this2 = this;

				if (this.elements.tooltip) {
					return;
				}

				//creates notification message
				var tooltip = this.createElement('div', { className: this.CSS_CLASS_NAMES.TOOLTIP }, [this.MESSAGES.PASSWORD_COPIED]);
				this.elements.tooltip = tooltip;
				var passwordElem = this.elements.password;
				passwordElem.parentNode.insertBefore(tooltip, passwordElem.nextSibling);

				//sets a notification display timeout
				setTimeout(function () {
					tooltip.remove();_this2.elements.tooltip = null;
				}, this.CONSTANTS.DELAY);
			}
		}, {
			key: 'lenghOnChangeHandler',
			value: function lenghOnChangeHandler(event) {
				var elem = event.target;
				this.length = parseInt(elem.value);
			}
		}, {
			key: 'getCharsetList',
			value: function getCharsetList() {
				var list = this.elements.charsetList.items.slice() || [];
				list = list.filter(function (item) {
					return item.checked;
				}).map(function (item) {
					return item.name;
				});
				return list;
			}
		}, {
			key: 'generateLengthElement',
			value: function generateLengthElement() {
				var container = this.createElement('select', { className: this.CSS_CLASS_NAMES.LENGTH });

				for (var l = 0; l <= this.maxLength - this.minLength; l++) {
					var value = l + this.minLength;
					var option = this.createElement('option', { value: value, innerHTML: value, selected: value === this.length ? true : false });
					container.appendChild(option);
				}

				return container;
			}
		}, {
			key: 'generateCharsetListElement',
			value: function generateCharsetListElement() {
				var container = this.createElement('div', { className: this.CSS_CLASS_NAMES.CHARSET_LIST, items: [] });
				var charset = this.charset;

				for (var str in charset) {
					var input = this.createElement('input', { type: 'checkbox', name: str, value: str, checked: true });
					var label = this.createElement('label', {}, [input, str]);
					container.items.push(input);
					container.appendChild(label);
				}

				return container;
			}
		}, {
			key: 'buttonClickHandler',
			value: function buttonClickHandler(e) {
				e.preventDefault();
				this.elements.password.value = this.core.generatePassword(this.length, this.getCharsetList());
			}
		}]);

		return PasswordGeneratorWidget;
	}();

	window.PasswordGeneratorWidget = PasswordGeneratorWidget;
})();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImpzL3Bhc3NnZW4uanMiXSwibmFtZXMiOlsiUGFzc3dvcmRHZW5lcmF0b3JDb3JlIiwic2VsZWN0ZWRDaGFyVHlwZXMiLCJ0eXBlcyIsImxlbmd0aCIsInByZXNldHMiLCJjaGFyVHlwZXMiLCJyYW5kb21DaGFyVHlwZSIsIk1hdGgiLCJmbG9vciIsInJhbmRvbSIsImNoYXJzZXRCeVR5cGUiLCJjaGFyc2V0IiwicmFuZG9tQ2hhciIsImxlbiIsIm1heExlbmd0aCIsIm1pbkxlbmd0aCIsIkFycmF5IiwiZnJvbSIsImdldFJhbmRvbUNoYXIiLCJqb2luIiwiUGFzc3dvcmRHZW5lcmF0b3JXaWRnZXQiLCJvcHRpb25zIiwiQ1NTX0NMQVNTX05BTUVTIiwiQlVUVE9OIiwiUEFTU1dPUkQiLCJQQVNTV09SRF9DT05UQUlORVIiLCJMRU5HVEgiLCJMRU5HVEhfQ09OVEFJTkVSIiwiVE9PTEJBUiIsIlBBU1NXT1JEX0dFTkVSQVRPUiIsIkNMRUFSRklYIiwiVE9PTFRJUCIsIkNIQVJTRVRfTElTVCIsIlNFTEVDVE9SUyIsIkNPTlRBSU5FUiIsImVsZW1lbnRzIiwiQ09OU1RBTlRTIiwiREVMQVkiLCJNRVNTQUdFUyIsIlBBU1NXT1JEX0NPUElFRCIsIkhJREUiLCJTSE9XIiwiY29yZSIsImNyZWF0ZUVsZW1lbnQiLCJjb250YWluZXIiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJzZWxlY3RvciIsIndpZGdldCIsImdlbmVyYXRlV2lkZ2V0Q29udGVudCIsImFzc2lnbkxpc3RlbmVycyIsInBhc3N3b3JkIiwidmFsdWUiLCJnZW5lcmF0ZVBhc3N3b3JkIiwiYnV0dG9uIiwiYWRkRXZlbnRMaXN0ZW5lciIsImJ1dHRvbkNsaWNrSGFuZGxlciIsImJpbmQiLCJvbkNvcHlFdmVudEhhbmRsZXIiLCJwYXNzd29yZE9uTW91c2VVcEhhbmRsZXIiLCJsZW5naE9uQ2hhbmdlSGFuZGxlciIsIndpZGdldENvbnRhaW5lciIsImNsYXNzTmFtZSIsInR5cGUiLCJwYXNzd29yZENvbnRhaW5lciIsImdlbmVyYXRlQnV0dG9uIiwiZ2VuZXJhdGVMZW5ndGhFbGVtZW50IiwibGVuZ3RoQ29udGFpbmVyIiwiY2hhcnNldExpc3QiLCJnZW5lcmF0ZUNoYXJzZXRMaXN0RWxlbWVudCIsImFwcGVuZENoaWxkIiwiZSIsImVsZW0iLCJ0YXJnZXQiLCJzZXRTZWxlY3Rpb25SYW5nZSIsImV4ZWNDb21tYW5kIiwiZXZlbnQiLCJ0b29sdGlwIiwicGFzc3dvcmRFbGVtIiwicGFyZW50Tm9kZSIsImluc2VydEJlZm9yZSIsIm5leHRTaWJsaW5nIiwic2V0VGltZW91dCIsInJlbW92ZSIsInBhcnNlSW50IiwibGlzdCIsIml0ZW1zIiwic2xpY2UiLCJmaWx0ZXIiLCJpdGVtIiwiY2hlY2tlZCIsIm1hcCIsIm5hbWUiLCJsIiwib3B0aW9uIiwiaW5uZXJIVE1MIiwic2VsZWN0ZWQiLCJzdHIiLCJpbnB1dCIsImxhYmVsIiwicHVzaCIsInByZXZlbnREZWZhdWx0IiwiZ2V0Q2hhcnNldExpc3QiLCJ3aW5kb3ciXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLENBQUUsQ0FBQyxZQUFZO0FBQ2Q7O0FBRGMsS0FHUkEscUJBSFE7QUFBQTtBQUFBO0FBQUE7O0FBQUE7QUFBQTtBQUFBLGlDQWlCU0MsaUJBakJULEVBaUI0QjtBQUN2QyxRQUFNQyxRQUFRRCxxQkFBcUJBLGtCQUFrQkUsTUFBdkMsSUFBaURGLGlCQUFqRCxJQUFzRSxLQUFLRyxPQUFMLENBQWFDLFNBQWpHO0FBQ0EsUUFBTUMsaUJBQWlCSixNQUFNSyxLQUFLQyxLQUFMLENBQVdELEtBQUtFLE1BQUwsS0FBZ0JQLE1BQU1DLE1BQWpDLENBQU4sQ0FBdkI7QUFDQSxRQUFNTyxnQkFBZ0IsS0FBS04sT0FBTCxDQUFhTyxPQUFiLENBQXFCTCxjQUFyQixDQUF0QjtBQUNBLFFBQU1NLGFBQWFGLGNBQWNILEtBQUtDLEtBQUwsQ0FBV0QsS0FBS0UsTUFBTCxLQUFnQkMsY0FBY1AsTUFBekMsQ0FBZCxDQUFuQjtBQUNBLFdBQU9TLFVBQVA7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MkIsS0FBS2xELE1BQWhDLEVBQXdDLEtBQUttRyxjQUFMLEVBQXhDLENBQS9CO0FBQ0E7QUFwS1k7O0FBQUE7QUFBQTs7QUF1S2RDLFFBQU9uRix1QkFBUCxHQUFpQ0EsdUJBQWpDO0FBQ0EsQ0F4S0MiLCJmaWxlIjoianMvcGFzc2dlbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIjsgKGZ1bmN0aW9uICgpIHtcblx0XCJ1c2Ugc3RyaWN0XCI7XG5cblx0Y2xhc3MgUGFzc3dvcmRHZW5lcmF0b3JDb3JlIHtcblx0XHRcdHN0YXRpYyBwcmVzZXRzID0ge1xuXHRcdFx0XHRsZW5ndGg6IDE2LFxuXHRcdFx0XHRtaW5MZW5ndGg6IDYsXG5cdFx0XHRcdG1heExlbmd0aDogMjU2LFxuXHRcdFx0XHRjaGFyVHlwZXM6IFsnbnVtYmVycycsICd1cHBlcmNhc2UnLCAnbG93ZXJjYXNlJywgJ3NwZWNpYWwnXSxcblx0XHRcdFx0Y2hhcnNldDoge1xuXHRcdFx0XHRcdCdudW1iZXJzJzogJzEyMzQ1Njc4OTAnLFxuXHRcdFx0XHRcdCd1cHBlcmNhc2UnOiAnQUJDREVGR0hJSktMTU5PUFFSU1RVVldYWVonLFxuXHRcdFx0XHRcdCdsb3dlcmNhc2UnOiAnYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXonLFxuXHRcdFx0XHRcdCdzcGVjaWFsJzogJyEjJCUmKCkqKywtLi86Ozw9Pj9AW11eX3t8fX4nXG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0c3RhdGljIGdldFJhbmRvbUNoYXIoc2VsZWN0ZWRDaGFyVHlwZXMpIHtcblx0XHRcdFx0Y29uc3QgdHlwZXMgPSBzZWxlY3RlZENoYXJUeXBlcyAmJiBzZWxlY3RlZENoYXJUeXBlcy5sZW5ndGggJiYgc2VsZWN0ZWRDaGFyVHlwZXMgfHwgdGhpcy5wcmVzZXRzLmNoYXJUeXBlcztcblx0XHRcdFx0Y29uc3QgcmFuZG9tQ2hhclR5cGUgPSB0eXBlc1tNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiB0eXBlcy5sZW5ndGgpXTtcblx0XHRcdFx0Y29uc3QgY2hhcnNldEJ5VHlwZSA9IHRoaXMucHJlc2V0cy5jaGFyc2V0W3JhbmRvbUNoYXJUeXBlXTtcblx0XHRcdFx0Y29uc3QgcmFuZG9tQ2hhciA9IGNoYXJzZXRCeVR5cGVbTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogY2hhcnNldEJ5VHlwZS5sZW5ndGgpXTtcblx0XHRcdFx0cmV0dXJuIHJhbmRvbUNoYXI7XG5cdFx0XHR9XG5cblx0XHRcdHN0YXRpYyBnZW5lcmF0ZVBhc3N3b3JkIChsZW4sIHNlbGVjdGVkQ2hhclR5cGVzKSB7XG5cdFx0XHRcdGxlbiA9IGxlbiB8fCB0aGlzLnByZXNldHMubGVuZ3RoO1xuXHRcdFx0XHRpZiAobGVuID4gdGhpcy5wcmVzZXRzLm1heExlbmd0aCkgeyBsZW4gPSB0aGlzLnByZXNldHMubWF4TGVuZ3RoOyB9XG5cdFx0XHRcdGlmIChsZW4gPCB0aGlzLnByZXNldHMubWluTGVuZ3RoKSB7IGxlbiA9IHRoaXMucHJlc2V0cy5taW5MZW5ndGg7IH1cblx0XHRcdFx0cmV0dXJuIEFycmF5LmZyb20oQXJyYXkobGVuKSwgKCkgPT4gdGhpcy5nZXRSYW5kb21DaGFyKHNlbGVjdGVkQ2hhclR5cGVzKSkuam9pbignJyk7XG5cdFx0XHR9XG5cdH1cblxuXHRjbGFzcyBQYXNzd29yZEdlbmVyYXRvcldpZGdldCB7XG5cdFx0Q1NTX0NMQVNTX05BTUVTID0ge1xuXHRcdFx0QlVUVE9OOiAncGFzc3dvcmQtZ2VuZXJhdG9yX19idXR0b24nLFxuXHRcdFx0UEFTU1dPUkQ6ICdwYXNzd29yZC1nZW5lcmF0b3JfX3Bhc3N3b3JkJyxcblx0XHRcdFBBU1NXT1JEX0NPTlRBSU5FUjogJ3Bhc3N3b3JkLWdlbmVyYXRvcl9fcGFzc3dvcmQtY29udGFpbmVyJyxcblx0XHRcdExFTkdUSDogJ3Bhc3N3b3JkLWdlbmVyYXRvcl9fbGVuZ3RoJyxcblx0XHRcdExFTkdUSF9DT05UQUlORVI6ICdwYXNzd29yZC1nZW5lcmF0b3JfX2xlbmd0aC1jb250YWluZXInLFxuXHRcdFx0VE9PTEJBUjogJ3Bhc3N3b3JkLWdlbmVyYXRvcl9fdG9vbGJhcicsXG5cdFx0XHRQQVNTV09SRF9HRU5FUkFUT1I6ICdwYXNzd29yZC1nZW5lcmF0b3InLFxuXHRcdFx0Q0xFQVJGSVg6ICdjbGVhcmZpeCcsXG5cdFx0XHRUT09MVElQOiAncGFzc3dvcmQtZ2VuZXJhdG9yX190b29sdGlwJyxcblx0XHRcdENIQVJTRVRfTElTVDogJ3Bhc3N3b3JkLWdlbmVyYXRvcl9fY2hhcnNldC1saXN0Jyxcblx0XHR9O1xuXG5cdFx0U0VMRUNUT1JTID0ge1xuXHRcdFx0Q09OVEFJTkVSOiAnI3Bhc3N3b3JkLWdlbmVyYXRvcicsXG5cdFx0fTtcblxuXHRcdGVsZW1lbnRzID0ge307XG5cblx0XHRDT05TVEFOVFMgPSB7REVMQVk6IDEwMDB9O1xuXG5cdFx0TUVTU0FHRVMgPSB7XG5cdFx0XHRQQVNTV09SRF9DT1BJRUQ6ICdjb3BpZWQnLFxuXHRcdFx0SElERTogJ2hpZGUnLFxuXHRcdFx0U0hPVzogJ3Nob3cnLFxuXHRcdH07XG5cblx0XHRjb25zdHJ1Y3RvcihvcHRpb25zKXtcblx0XHRcdG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xuXHRcdFx0dGhpcy5jb3JlID0gUGFzc3dvcmRHZW5lcmF0b3JDb3JlO1xuXHRcdFx0dGhpcy5jcmVhdGVFbGVtZW50ID0gY3JlYXRlRWxlbWVudDtcblx0XHRcdHRoaXMubGVuZ3RoID0gb3B0aW9ucy5sZW5ndGggfHwgdGhpcy5jb3JlLnByZXNldHMubGVuZ3RoO1xuXHRcdFx0dGhpcy5taW5MZW5ndGggPSB0aGlzLmNvcmUucHJlc2V0cy5taW5MZW5ndGg7XG5cdFx0XHR0aGlzLm1heExlbmd0aCA9IHRoaXMuY29yZS5wcmVzZXRzLm1heExlbmd0aDtcblx0XHRcdHRoaXMuY29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihvcHRpb25zLnNlbGVjdG9yIHx8IHRoaXMuU0VMRUNUT1JTLkNPTlRBSU5FUik7XG5cdFx0XHR0aGlzLmNoYXJzZXQgPSBvcHRpb25zLmNoYXJzZXQgfHwgdGhpcy5jb3JlLnByZXNldHMuY2hhcnNldDtcblx0XHRcdHRoaXMud2lkZ2V0ID0gdGhpcy5nZW5lcmF0ZVdpZGdldENvbnRlbnQodGhpcy5jb250YWluZXIpO1xuXHRcdFx0dGhpcy5hc3NpZ25MaXN0ZW5lcnMoKTtcblx0XHRcdHRoaXMuZWxlbWVudHMucGFzc3dvcmQudmFsdWUgPSB0aGlzLmNvcmUuZ2VuZXJhdGVQYXNzd29yZCh0aGlzLmxlbmd0aCk7XG5cdFx0fVxuXG5cdFx0YXNzaWduTGlzdGVuZXJzKCkge1xuXHRcdFx0dGhpcy5lbGVtZW50cy5idXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLmJ1dHRvbkNsaWNrSGFuZGxlci5iaW5kKHRoaXMpKTtcblx0XHRcdC8vc2hvd3Mgbm90aWZpY2F0aW9uIGFmdGVyIHBhc3N3b3JkIHdhcyBjb3BpZWRcblx0XHRcdHRoaXMud2lkZ2V0LmFkZEV2ZW50TGlzdGVuZXIoJ2NvcHknLCB0aGlzLm9uQ29weUV2ZW50SGFuZGxlci5iaW5kKHRoaXMpKTtcblx0XHRcdHRoaXMuZWxlbWVudHMucGFzc3dvcmQuYWRkRXZlbnRMaXN0ZW5lcignbW91c2V1cCcsIHRoaXMucGFzc3dvcmRPbk1vdXNlVXBIYW5kbGVyLmJpbmQodGhpcykpO1xuXHRcdFx0dGhpcy5lbGVtZW50cy5sZW5ndGguYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgdGhpcy5sZW5naE9uQ2hhbmdlSGFuZGxlci5iaW5kKHRoaXMpKTtcblx0XHR9XG5cblx0XHRnZW5lcmF0ZVdpZGdldENvbnRlbnQod2lkZ2V0Q29udGFpbmVyKSB7XG5cdFx0XHRjb25zdCBwYXNzd29yZCA9IHRoaXMuY3JlYXRlRWxlbWVudCgnaW5wdXQnLCB7Y2xhc3NOYW1lOiB0aGlzLkNTU19DTEFTU19OQU1FUy5QQVNTV09SRCwgdHlwZTogJ3RleHQnLCB2YWx1ZTogJ3Bhc3N3b3JkJ30pO1xuXHRcdFx0dGhpcy5lbGVtZW50cy5wYXNzd29yZCA9IHBhc3N3b3JkO1xuXHRcdFx0Y29uc3QgcGFzc3dvcmRDb250YWluZXIgPSB0aGlzLmNyZWF0ZUVsZW1lbnQoJ2RpdicsIHtjbGFzc05hbWU6IHRoaXMuQ1NTX0NMQVNTX05BTUVTLlBBU1NXT1JEX0NPTlRBSU5FUn0sIFtwYXNzd29yZF0pO1xuXHRcdFx0Y29uc3QgZ2VuZXJhdGVCdXR0b24gPSB0aGlzLmNyZWF0ZUVsZW1lbnQoJ2lucHV0Jywge2NsYXNzTmFtZTogdGhpcy5DU1NfQ0xBU1NfTkFNRVMuQlVUVE9OLCB0eXBlOiAnYnV0dG9uJywgdmFsdWU6ICdnZW5lcmF0ZSd9KTtcblx0XHRcdHRoaXMuZWxlbWVudHMuYnV0dG9uID0gZ2VuZXJhdGVCdXR0b247XG5cdFx0XHRjb25zdCBsZW5ndGggPSB0aGlzLmdlbmVyYXRlTGVuZ3RoRWxlbWVudCgpO1xuXHRcdFx0dGhpcy5lbGVtZW50cy5sZW5ndGggPSBsZW5ndGg7XG5cdFx0XHRjb25zdCBsZW5ndGhDb250YWluZXIgPSB0aGlzLmNyZWF0ZUVsZW1lbnQoJ2RpdicsIHtjbGFzc05hbWU6IHRoaXMuQ1NTX0NMQVNTX05BTUVTLkxFTkdUSF9DT05UQUlORVJ9LCBbbGVuZ3RoXSk7XG5cdFx0XHRjb25zdCBjaGFyc2V0TGlzdCA9IHRoaXMuZ2VuZXJhdGVDaGFyc2V0TGlzdEVsZW1lbnQoKTtcblx0XHRcdHRoaXMuZWxlbWVudHMuY2hhcnNldExpc3QgPSBjaGFyc2V0TGlzdDtcblx0XHRcdGNvbnN0IHdpZGdldCA9IHRoaXMuY3JlYXRlRWxlbWVudCgnZGl2Jywge2NsYXNzTmFtZTogYCR7dGhpcy5DU1NfQ0xBU1NfTkFNRVMuUEFTU1dPUkRfR0VORVJBVE9SfSAke3RoaXMuQ1NTX0NMQVNTX05BTUVTLkNMRUFSRklYfWB9LFxuXHRcdFx0XHRbcGFzc3dvcmRDb250YWluZXIsIGdlbmVyYXRlQnV0dG9uLCBsZW5ndGhDb250YWluZXIsIGNoYXJzZXRMaXN0XSk7XG5cdFx0XHR3aWRnZXRDb250YWluZXIuYXBwZW5kQ2hpbGQod2lkZ2V0KTtcblx0XHRcdHJldHVybiB3aWRnZXQ7XG5cdFx0fVxuXG5cdFx0Ly9jb3BpZXMgcGFzc3dvcmQgdG8gY2xpcGJvYXJkXG5cdFx0cGFzc3dvcmRPbk1vdXNlVXBIYW5kbGVyKGUpIHtcblx0XHRcdGNvbnN0IGVsZW0gPSBlLnRhcmdldDtcblxuXHRcdFx0Ly8gc2VsZWN0cyBwYXNzd29yZCBhbmQgY29weSBpdCB0byBjbGlwYm9hcmRcblx0XHRcdC8vIGRvZXMgbm90IHdvcmsgb24gaU9TIGRldmljZXNcblx0XHRcdGVsZW0uc2V0U2VsZWN0aW9uUmFuZ2UoMCwgZWxlbS52YWx1ZS5sZW5ndGgpO1xuXHRcdFx0ZG9jdW1lbnQuZXhlY0NvbW1hbmQoJ2NvcHknKTtcblx0XHR9XG5cblx0XHQvL3Nob3dzIFwiY29waWVkXCIgbm90aWZpY2F0aW9uXG5cdFx0b25Db3B5RXZlbnRIYW5kbGVyIChldmVudCkge1xuXHRcdFx0aWYgKHRoaXMuZWxlbWVudHMudG9vbHRpcCkgeyByZXR1cm47IH1cblxuXHRcdFx0Ly9jcmVhdGVzIG5vdGlmaWNhdGlvbiBtZXNzYWdlXG5cdFx0XHRjb25zdCB0b29sdGlwID0gdGhpcy5jcmVhdGVFbGVtZW50KCdkaXYnLCB7Y2xhc3NOYW1lOiB0aGlzLkNTU19DTEFTU19OQU1FUy5UT09MVElQfSwgW3RoaXMuTUVTU0FHRVMuUEFTU1dPUkRfQ09QSUVEXSk7XG5cdFx0XHR0aGlzLmVsZW1lbnRzLnRvb2x0aXAgPSB0b29sdGlwO1xuXHRcdFx0Y29uc3QgcGFzc3dvcmRFbGVtID0gdGhpcy5lbGVtZW50cy5wYXNzd29yZDtcblx0XHRcdHBhc3N3b3JkRWxlbS5wYXJlbnROb2RlLmluc2VydEJlZm9yZSh0b29sdGlwLCBwYXNzd29yZEVsZW0ubmV4dFNpYmxpbmcpXG5cblx0XHRcdC8vc2V0cyBhIG5vdGlmaWNhdGlvbiBkaXNwbGF5IHRpbWVvdXRcblx0XHRcdHNldFRpbWVvdXQoKCkgPT4geyB0b29sdGlwLnJlbW92ZSgpOyB0aGlzLmVsZW1lbnRzLnRvb2x0aXAgPSBudWxsOyB9LCB0aGlzLkNPTlNUQU5UUy5ERUxBWSk7XG5cdFx0fTtcblxuXHRcdGxlbmdoT25DaGFuZ2VIYW5kbGVyKGV2ZW50KSB7XG5cdFx0XHRjb25zdCBlbGVtID0gZXZlbnQudGFyZ2V0O1xuXHRcdFx0dGhpcy5sZW5ndGggPSBwYXJzZUludChlbGVtLnZhbHVlKTtcblx0XHR9XG5cblx0XHRnZXRDaGFyc2V0TGlzdCgpIHtcblx0XHRcdGxldCBsaXN0ID0gdGhpcy5lbGVtZW50cy5jaGFyc2V0TGlzdC5pdGVtcy5zbGljZSgpIHx8IFtdO1xuXHRcdFx0bGlzdCA9IGxpc3QuZmlsdGVyKGl0ZW0gPT4gaXRlbS5jaGVja2VkKS5tYXAoaXRlbSA9PiBpdGVtLm5hbWUpO1xuXHRcdFx0cmV0dXJuIGxpc3Q7XG5cdFx0fVxuXG5cdFx0Z2VuZXJhdGVMZW5ndGhFbGVtZW50KCkge1xuXHRcdFx0Y29uc3QgY29udGFpbmVyID0gdGhpcy5jcmVhdGVFbGVtZW50KCdzZWxlY3QnLCB7Y2xhc3NOYW1lOiB0aGlzLkNTU19DTEFTU19OQU1FUy5MRU5HVEh9KTtcblxuXHRcdFx0Zm9yIChsZXQgbCA9IDA7IGwgPD0gdGhpcy5tYXhMZW5ndGggLSB0aGlzLm1pbkxlbmd0aDsgbCsrKSB7XG5cdFx0XHRcdGNvbnN0IHZhbHVlID0gbCArIHRoaXMubWluTGVuZ3RoO1xuXHRcdFx0XHRjb25zdCBvcHRpb24gPSB0aGlzLmNyZWF0ZUVsZW1lbnQoJ29wdGlvbicsIHt2YWx1ZTogdmFsdWUsIGlubmVySFRNTDogdmFsdWUsIHNlbGVjdGVkOiB2YWx1ZSA9PT0gdGhpcy5sZW5ndGggPyB0cnVlIDogZmFsc2V9KTtcblx0XHRcdFx0Y29udGFpbmVyLmFwcGVuZENoaWxkKG9wdGlvbik7XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBjb250YWluZXI7XG5cdFx0fVxuXG5cdFx0Z2VuZXJhdGVDaGFyc2V0TGlzdEVsZW1lbnQoKSB7XG5cdFx0XHRjb25zdCBjb250YWluZXIgPSB0aGlzLmNyZWF0ZUVsZW1lbnQoJ2RpdicsIHtjbGFzc05hbWU6IHRoaXMuQ1NTX0NMQVNTX05BTUVTLkNIQVJTRVRfTElTVCwgaXRlbXM6IFtdfSk7XG5cdFx0XHRjb25zdCBjaGFyc2V0ID0gdGhpcy5jaGFyc2V0O1xuXG5cdFx0XHRmb3IgKGxldCBzdHIgaW4gY2hhcnNldCl7XG5cdFx0XHRcdGNvbnN0IGlucHV0ID0gdGhpcy5jcmVhdGVFbGVtZW50KCdpbnB1dCcsIHt0eXBlOiAnY2hlY2tib3gnLCBuYW1lOiBzdHIsIHZhbHVlOiBzdHIsIGNoZWNrZWQ6IHRydWV9KTtcblx0XHRcdFx0Y29uc3QgbGFiZWwgPSB0aGlzLmNyZWF0ZUVsZW1lbnQoJ2xhYmVsJywge30sIFtpbnB1dCwgc3RyXSk7XG5cdFx0XHRcdGNvbnRhaW5lci5pdGVtcy5wdXNoKGlucHV0KTtcblx0XHRcdFx0Y29udGFpbmVyLmFwcGVuZENoaWxkKGxhYmVsKTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIGNvbnRhaW5lcjtcblx0XHR9XG5cblx0XHRidXR0b25DbGlja0hhbmRsZXIgKGUpIHtcblx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHRcdHRoaXMuZWxlbWVudHMucGFzc3dvcmQudmFsdWUgPSB0aGlzLmNvcmUuZ2VuZXJhdGVQYXNzd29yZCh0aGlzLmxlbmd0aCwgdGhpcy5nZXRDaGFyc2V0TGlzdCgpKTtcblx0XHR9XG5cdH1cblxuXHR3aW5kb3cuUGFzc3dvcmRHZW5lcmF0b3JXaWRnZXQgPSBQYXNzd29yZEdlbmVyYXRvcldpZGdldDtcbn0pKCk7XG4iXX0=
